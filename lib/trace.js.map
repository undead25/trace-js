{"version":3,"file":"trace.js","sources":["../src/config.ts","../src/util.ts","../src/request.ts","../src/performance.ts","../src/breadcrumbs.ts","../src/environment.ts","../src/report.ts","../src/exception.ts","../src/index.ts"],"sourcesContent":["\nexport const defaultConfig: Trace.Config = {\n  apiKey: '',\n  exceptionUrl: 'http://localhost:3001/tracer/error',\n  performanceUrl: 'http://localhost:3001/api/perf/create',\n  ignoreErrors: [],\n  ignoreUrls: [],\n  autoBreadcrumbs: {\n    dom: true,\n    xhr: true,\n    location: true,\n    console: false\n  },\n  releaseStage: 'production',\n  catchAjax: true,\n  catchConsole: true,\n  maxStackDepth: 10,\n  repeatReport: false,\n  maxBreadcrumbs: 100\n}\n","\n/**\n * 是否为IE浏览器\n * @returns {boolean} \n */\nexport function isIE(): boolean {\n  return navigator.appVersion.indexOf(\"MSIE\") !== -1;\n}\n\nexport function isError(value: any): boolean {\n  switch (Object.prototype.toString.call(value)) {\n    case '[object Error]': return true;\n    case '[object Exception]': return true;\n    case '[object DOMException]': return true;\n    default: return value instanceof Error;\n  }\n}\n\n/**\n * 生产唯一ID\n * @returns {string} - 唯一guid\n */\nexport function guid(): string {\n  var crypto = window.crypto || window['msCrypto'];\n\n  if (crypto && crypto.getRandomValues) {\n    // Use window.crypto API if available\n    var arr = new Uint16Array(8);\n    crypto.getRandomValues(arr);\n\n    // set 4 in byte 7\n    arr[3] = arr[3] & 0xFFF | 0x4000;\n    // set 2 most significant bits of byte 9 to '10'\n    arr[4] = arr[4] & 0x3FFF | 0x8000;\n\n    var pad = function (num) {\n      var v = num.toString(16);\n      while (v.length < 4) {\n        v = '0' + v;\n      }\n      return v;\n    };\n\n    return pad(arr[0]) + pad(arr[1]) + pad(arr[2]) + pad(arr[3]) + pad(arr[4]) +\n      pad(arr[5]) + pad(arr[6]) + pad(arr[7]);\n  } else {\n    // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\n    return 'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n      var r = Math.random() * 16 | 0,\n        v = c === 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  }\n}\n\n/**\n * 文档绑定自定义事件\n * @export\n * @param {string} eventType \n * @param {Object} [options={}] \n * @returns {void} \n */\nexport function triggerEvent(eventType: string, options: Object = {}): void {\n  if (!document) return;\n\n  let _event: Event;\n  let key: string;\n\n  eventType = eventType.substr(0, 1).toUpperCase + eventType.substr(1);\n\n  if (document.createEvent) {\n    _event = document.createEvent('HTMLEvents');\n    _event.initEvent(eventType, true, true);\n  } else {\n    // IE8-9\n    _event = document['createEventObject']();\n    (_event as any).eventType = eventType;\n  }\n\n  for (key in options) {\n    if (options.hasOwnProperty(key)) {\n      _event[key] = options[key];\n    }\n  }\n\n  if (document.createEvent) {\n    document.dispatchEvent(_event);\n  } else {\n    document['fireEvent']('on' + (_event as any).eventType.toLowerCase(), _event);\n  }\n}\n\n/**\n * 原生方法垫片\n * @param {Object} obj - 内置对象，例：`window`, `document`\n * @param {string} name - 内置对象的函数名称，例：`addEventListener`\n * @param {Function} replacement - 替换后的函数\n * @param {*} [track] - record instrumentation to an array\n */\nexport function polyfill(obj: Object, name: string, replacement: Function, track?: any): void {\n  const origin = obj[name];\n  obj[name] = replacement(origin);\n  if (track) {\n    track.push([obj, name, origin]);\n  }\n}\n\nexport function wrap(options: any, func?: any, origin?: any) {\n  if (!func && typeof options !== 'function') return options;\n\n  if (typeof options === 'function') {\n    func = options;\n    options = undefined;\n  }\n\n  if (typeof func !== 'function') return func;\n\n  try {\n    if (func.trace) return func;\n    if (func.track_wrapper) return func.track_wrapper;\n  } catch (e) {\n    return func;\n  }\n\n  function wrapped() {\n    let trace, inner;\n    var args = [], i = arguments.length,\n      deep = !options || options && options.deep !== false;\n\n    if (origin && typeof origin === 'function') {\n      origin.apply(this, arguments);\n    }\n\n    while (i--) args[i] = deep ? wrap(options, arguments[i]) : arguments[i];\n\n    try {\n      return func.apply(this, args);\n    } catch (e) {\n      // self._ignoreNextOnError();\n      // self.captureException(e, options);\n      throw e;\n    }\n\n  }\n  // copy over properties of the old function\n  for (var property in func) {\n    if (func.hasOwnProperty(process)) {\n      wrapped[property] = func[property];\n    }\n  }\n  wrapped.prototype = func.prototype;\n\n  func.track_wrapper = wrapped;\n  // Signal that this function has been wrapped already\n  // for both debugging and to prevent it to being wrapped twice\n  // wrapped.trace = true;\n  // wrapped.inner = func;\n\n  return wrapped;\n}\n\n\n/**\n * \n * @param {Array<RegExp>} patterns \n * @returns {RegExp} \n */\nexport function joinRegExp(patterns: Array<RegExp>): RegExp {\n  let sources = [];\n  let pattern;\n  for (let i = 0; i < patterns.length; i++) {\n    pattern = patterns[i];\n    if (typeof pattern === 'string') {\n      sources.push(pattern.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, '\\\\$1'));\n    } else if (pattern && pattern.source) {\n      // If it's a regexp already, we want to extract the source\n      sources.push(pattern.source);\n    }\n  }\n  return new RegExp(sources.join('|'), 'i');\n}\n\n/**\n * Given a child DOM element, returns a query-selector statement describing that\n * and its ancestors\n * e.g. [HTMLElement] => body > div > input#foo.btn[name=baz]\n * @param elem\n * @returns {string}\n */\nexport function htmlTreeAsString(element: HTMLElement): string {\n  var MAX_TRAVERSE_HEIGHT = 5,\n    MAX_OUTPUT_LEN = 80,\n    out = [],\n    height = 0,\n    len = 0,\n    separator = ' > ',\n    sepLength = separator.length,\n    nextStr;\n\n  while (element && height++ < MAX_TRAVERSE_HEIGHT) {\n    nextStr = htmlElementAsString(element);\n    if (nextStr === 'html' || height > 1 && len + (out.length * sepLength) + nextStr.length >= MAX_OUTPUT_LEN) {\n      break;\n    }\n\n    out.push(nextStr);\n\n    len += nextStr.length;\n    element = element.parentElement;\n  }\n\n  return out.reverse().join(separator);\n}\n\n/**\n * Returns a simple, query-selector representation of a DOM element\n * e.g. [HTMLElement] => input#foo.btn[name=baz]\n * @param HTMLElement\n * @returns {string}\n */\nfunction htmlElementAsString(element: HTMLElement): string {\n  var out = [],\n    className,\n    classes,\n    key,\n    attr,\n    i;\n\n  if (!element || !element.tagName) {\n    return '';\n  }\n\n  out.push(element.tagName.toLowerCase());\n  if (element.id) {\n    out.push('#' + element.id);\n  }\n\n  className = element.className;\n  if (className && typeof className === 'string') {\n    classes = className.split(/\\s+/);\n    for (i = 0; i < classes.length; i++) {\n      out.push('.' + classes[i]);\n    }\n  }\n  var attrWhitelist = ['type', 'name', 'title', 'alt'];\n  for (i = 0; i < attrWhitelist.length; i++) {\n    key = attrWhitelist[i];\n    attr = element.getAttribute(key);\n    if (attr) {\n      out.push('[' + key + '=\"' + attr + '\"]');\n    }\n  }\n  return out.join('');\n}\n\n// borrowed from https://tools.ietf.org/html/rfc3986#appendix-B\n// intentionally using regex and not <a/> href parsing trick because React Native and other\n// environments where DOM might not be available\nexport function parseUrl(url: string) {\n  var match = url.match(/^(([^:\\/?#]+):)?(\\/\\/([^\\/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$/);\n  if (!match) return;\n\n  // coerce to undefined values to empty string so we don't get 'undefined'\n  var query = match[6] || '';\n  var fragment = match[8] || '';\n  return {\n    protocol: match[2],\n    host: match[4],\n    path: match[5],\n    relative: match[5] + query + fragment // everything minus origin\n  };\n}\n\n/**\n * 获取元素的属性值 \n * @param {HTMLElement} element  - 需要获取属性的元素\n * @returns {Object} - 属性键值对象\n */\nexport function getAttributes(element: HTMLElement): Object {\n  const result: Object = {};\n  const attributes: NamedNodeMap = element.attributes;\n\n  for (let i = 0; i < attributes.length; i++) {\n    const item = attributes[i];\n    result[item.name] = item.value;\n  }\n\n  return result;\n}","export function makeRequest(options: any):void {\n  let request:XMLHttpRequest = new XMLHttpRequest();\n  const hasCORS:boolean = 'withCredentials' in request || typeof window['XDomainRequest'] !== 'undefined';\n\n  if (!hasCORS) return;\n\n  let url = options.url;\n  if ('withCredentials' in request) {\n    request.onreadystatechange = () => {\n      if (request.readyState !== 4) {\n        return;\n      } else if (request.status === 200) {\n        options.onSuccess = options.onSuccess();\n      } else if (options.onError) {\n        let error: any = new Error(`Error: ${request.status}`);\n        error.request = request;\n        options.onError(error);\n      }\n    }\n  } else {\n    // xdomainrequest cannot go http -> https (or vice versa),\n    // so always use protocol relative\n    request = new (window as any).XDomainRequest();\n    url = url.replace(/^https?:/, '');\n\n    // onreadystatechange not supported by XDomainRequest\n    if(options.onSuccess) request.onload = options.onSuccess;\n    if(options.onError) {\n      request.onerror = () => {\n        let error: any = new Error(`Error: XDomainRequest`);\n        error.request = request;\n        options.onError(error);\n      }\n    }\n  }\n\n  request.open('POST', url, true);\n  request.send(JSON.stringify(options.data));\n}\n","import { makeRequest } from './request';\nimport { triggerEvent } from './util';\n\nexport default class Performance {\n  public collection: Object;\n  public config: Trace.Config;\n\n  /**\n   * Creates an instance of Performance.\n   * @param {Trace.Config} config \n   */\n  constructor(config: Trace.Config) {\n    this.config = config;\n    this.getCollection();\n  }\n\n  /**\n   * Sending performance payload using xhr or beacon\n   * @returns {void} \n   */\n  public payloadSending(): void {\n    if (!this.collection || this.collection['dom'] < 0) return;\n\n    const data = JSON.stringify(this.collection);\n    if (window.navigator && window.navigator.sendBeacon) {\n      console.log('url change')\n      window.navigator.sendBeacon(this.config.performanceUrl, data);\n    } else {\n      const requestOptions = {\n        url: this.config.performanceUrl,\n        data,\n        onSuccess: () => {\n          triggerEvent('success', {\n            data,\n            src: this.config.performanceUrl\n          })\n          return new Promise(() => { });\n        },\n        OnError: (error) => {\n          triggerEvent('failure', {\n            data,\n            src: this.config.performanceUrl\n          })\n          error = error || new Error(`发送上报请求失败`);\n          return new Promise(resolve => resolve(error))\n        }\n      }\n      // 发送报告请求\n      makeRequest(requestOptions);\n    }\n  }\n\n  /**\n   * Collect performance metrics data\n   * @returns {void} \n   */\n  private getCollection(): void {\n    if (!window.performance) return;\n\n    const timing = window.performance.timing;\n    const navigation = window.performance.navigation;\n    const resource: Array<any> = window.performance.getEntriesByType('resource');\n\n    // 重定向时间\n    const redirect = timing.redirectEnd - timing.redirectStart;\n    // DNS 解析耗时\n    const dns = timing.domainLookupEnd - timing.domainLookupStart;\n    // TCP 链接耗时\n    const tcp = timing.connectEnd - timing.connectStart;\n    // TLS 耗时\n    const tls = timing.secureConnectionStart === 0 ? 0 : timing.secureConnectionStart - timing.connectStart;\n    // 白屏时间\n    const firstPaint = timing.responseStart - timing.navigationStart;\n    // 总体网络交互耗时\n    const network = timing.responseEnd - timing.navigationStart;\n    // DOM解析时间\n    const dom = timing.domComplete - timing.responseEnd;\n    // 首屏时间 (暂不靠谱)\n    const firstScreen = timing.domContentLoadedEventEnd - timing.navigationStart;\n    // 用户可操作时间\n    const interactive = timing.domInteractive - timing.navigationStart;\n    // 页面加载时间\n    const pageLoad = timing.loadEventStart - timing.navigationStart;\n\n    // 重定向次数\n    const redirectCount = navigation.redirectCount;\n    // 网页的加载来源\n    const navigationType = navigation.type;\n\n    let resources: Array<any> = [];\n    resource.forEach(item => {\n      const { initiatorType, name, duration, transferSize } = item;\n      resources.push({\n        url: name,\n        tag: initiatorType,\n        duration: duration.toFixed(2),\n        size: transferSize\n      })\n    });\n\n    this.collection = {\n      redirect, dns, tcp, tls, firstPaint, network, dom, firstScreen, interactive, pageLoad,\n      redirectCount, navigationType,\n      resources,\n      userAgent: window.navigator.userAgent,\n      url: window.location.href,\n      protocol: window.location.protocol,\n      apiKey: this.config.apiKey,\n      domain: window.location.protocol + '//' + window.location.host,\n      timing: JSON.stringify(timing)\n    }\n  }\n}\n","import { getAttributes, htmlTreeAsString, polyfill, wrap, parseUrl } from './util';\nimport Perf from './performance';\n\nexport class BreadCrumbs {\n  public crumbsData: Array<Trace.BreadCrumb> = [];\n\n  private _config: Trace.Config;\n  private wrappedBuiltIns: Array<any> = [];\n\n  private clickEventSelectors: Array<string>;\n  private changeEventSelectors: Array<string>;\n\n  private lastEvent: Event = null;\n  private lastHref: string = '';\n\n  constructor(config: Trace.Config) {\n    this._config = config;\n    this.getDomBreadcrumbs();\n    this.getXhrBreadcrumbs();\n    this.getLocationBreadcurmbs();\n    this.getConsoleBreadcrumbs();\n  }\n\n  /**\n   * 获取事件操作并写入面包屑\n   * @private\n   */\n  private getDomBreadcrumbs(): void {\n    if (!this._config.autoBreadcrumbs.dom) return;\n\n    this.clickEventSelectors = ['a', 'button', 'input[button]', 'input[submit]', 'input[radio]', 'input[checkbox]'];\n    this.changeEventSelectors = ['input[text]', 'input[password]', 'textarea', 'select'];\n\n    if (document.addEventListener) {\n      document.addEventListener('click', (event: MouseEvent) => {\n        this.eventHandler('click', this.clickEventSelectors, event);\n      }, true);\n      document.addEventListener('blur', (event: MouseEvent) => {\n        this.eventHandler('input', this.changeEventSelectors, event)\n      }, true);\n    } else {\n      // IE8\n      document['attachEvent']('onclick', (event: MouseEvent) => {\n        this.eventHandler('click', this.clickEventSelectors, event);\n      });\n      document['attachEvent']('onblur', (event: MouseEvent) => {\n        this.eventHandler('click', this.clickEventSelectors, event);\n      })\n    }\n  }\n\n  /**\n   * \n   * @private\n   * @param {string} eventName \n   * @param {Array<string>} selectorFilters \n   * @param {MouseEvent} event \n   */\n  private eventHandler(eventName: string, selectorFilters: Array<string>, event: MouseEvent): void {\n    const target = event.target || event.srcElement;\n    const tagName: string = (target as HTMLElement).tagName.toLowerCase();\n\n    if (this.acceptTag(target as HTMLElement, selectorFilters)) {\n      const attributes = getAttributes(target as HTMLElement);\n      let inputElement = target as HTMLInputElement;\n\n      const result: Trace.BreadCrumb = {\n        category: `ui.${eventName}`,\n        htmlTree: htmlTreeAsString(target as HTMLElement)\n      }\n\n      this.captureBreadcrumb(result);\n    }\n  }\n\n  /**\n   * 查看某个元素是否在要监控的元素类型列表中\n   * @private\n   * @param {HTMLElement} element - 要检测的元素\n   * @param {Array<string>} selectors - 元素列表字符串\n   * @returns {boolean} - 检测结果\n   */\n  private acceptTag(element: HTMLElement, selectors: Array<string>): boolean {\n    let tag: string = element.tagName.toLowerCase();\n    if (tag === 'input' && element.getAttribute('type')) {\n      tag += `[${element.getAttribute('type')}]`\n    }\n    return selectors.indexOf(tag) > -1;\n  }\n\n  /**\n   * 获取事件操作并写入面包屑\n   */\n  private getXhrBreadcrumbs() {\n    if (!this._config.autoBreadcrumbs.xhr) return;\n\n    const self = this;\n    const autoBreadcrumbs = this._config.autoBreadcrumbs;\n    const wrappedBuiltIns = this.wrappedBuiltIns;\n    const xhrproto = XMLHttpRequest.prototype;\n\n    function wrapProp(prop, xhr) {\n      if (prop in xhr && typeof (xhr[prop]) === 'function') {\n        polyfill(xhr, prop, function (origin) {\n          return wrap(origin);\n        });\n      }\n    }\n\n    // 复制改下 xhr open 用于监听\n    polyfill(xhrproto, 'open', function (origOpen: any) {\n      return function (method: string, url: string) {\n\n        this._trace_xhr = {\n          method: method,\n          url: url,\n          statusCode: null\n        };\n        return origOpen.apply(this, arguments);\n      };\n    }, wrappedBuiltIns);\n\n    // 复制改下 xhr send 用于监听\n    polyfill(xhrproto, 'send', function (origSend) {\n      return function (data) {\n        var xhr = this;\n        function onreadystatechangeHandler() {\n          if (xhr._trace_xhr && (xhr.readyState === 1 || xhr.readyState === 4)) {\n            xhr._trace_xhr.statusCode = xhr.status;\n            self.captureBreadcrumb({\n              type: 'http',\n              category: 'xhr',\n              data: xhr._trace_xhr\n            });\n          }\n        }\n\n        const props = ['onload', 'onerror', 'onprogress'];\n        for (var j = 0; j < props.length; j++) {\n          wrapProp(props[j], xhr);\n        }\n\n        if ('onreadystatechange' in xhr && typeof xhr.onreadystatechange === 'function') {\n          polyfill(xhr, 'onreadystatechange', function (origin) {\n            return wrap(origin, undefined, onreadystatechangeHandler);\n          })\n        } else {\n          xhr.onreadystatechange = onreadystatechangeHandler;\n        }\n        return origSend.apply(this, arguments);\n      };\n    }, wrappedBuiltIns);\n  }\n\n  private getLocationBreadcurmbs() {\n    if (!this._config.autoBreadcrumbs.location) return;\n\n    const wrappedBuiltIns = this.wrappedBuiltIns;\n    const self = this;\n    const chrome = window['chrome'];\n    const isChromePackagedApp = chrome && chrome.app && chrome.app.runtime;\n    const hasPushState = !isChromePackagedApp && window.history && history.pushState;\n    if (hasPushState) {\n      var oldOnPopState = window.onpopstate;\n      window.onpopstate = function () {\n        var currentHref = location.href;\n        self.captureUrlChange(self.lastHref, currentHref);\n        if (oldOnPopState) {\n          return oldOnPopState.apply(this, arguments);\n        }\n      };\n\n      polyfill(history, 'pushState', function (origPushState) {\n        // note history.pushState.length is 0; intentionally not declaring\n        // params to preserve 0 arity\n        return function (/* state, title, url */) {\n          var url = arguments.length > 2 ? arguments[2] : undefined;\n\n          // url argument is optional\n          if (url) {\n            // coerce to string (this is what pushState does)\n            self.captureUrlChange(self.lastHref, url + '');\n          }\n\n          return origPushState.apply(this, arguments);\n        };\n      }, wrappedBuiltIns);\n    }\n  }\n\n  /**\n   * Captures a breadcrumb of type \"navigation\", normalizing input URLs\n   * @param to the originating URL\n   * @param from the target URL\n   * @private\n   */\n  private captureUrlChange(from, to) {\n    var parsedLoc = parseUrl(location.href);\n    var parsedTo = parseUrl(to);\n    var parsedFrom = parseUrl(from);\n\n    // because onpopstate only tells you the \"new\" (to) value of location.href, and\n    // not the previous (from) value, we need to track the value of the current URL\n    // state ourselves\n    this.lastHref = to;\n\n    // Use only the path component of the URL if the URL matches the current\n    // document (almost all the time when using pushState)\n    if (parsedLoc.protocol === parsedTo.protocol && parsedLoc.host === parsedTo.host) {\n      to = parsedTo.relative;\n    }\n\n    if (parsedLoc.protocol === parsedFrom.protocol && parsedLoc.host === parsedFrom.host) {\n      from = parsedFrom.relative;\n    }\n\n    const perf = new Perf(this._config);\n    perf.payloadSending();\n\n    this.captureBreadcrumb({\n      category: 'navigation',\n      data: {\n        to: to,\n        from: from\n      }\n    });\n  }\n\n  private getConsoleBreadcrumbs() {\n    if (!this._config.autoBreadcrumbs.console) return;\n    if ('console' in window && console.log) {\n      const consoleMethodCallback = (msg, data) => {\n        this.captureBreadcrumb({\n          message: msg,\n          level: data.level,\n          category: 'console'\n        });\n      };\n      ['debug', 'info', 'warn', 'error', 'log'].forEach((item) => {\n        this.wrapConsole(console, item, consoleMethodCallback);\n      })\n    }\n  }\n\n  private wrapConsole(console, level, callback) {\n    const originalConsoleLevel = console[level];\n    const originalConsole = console;\n\n    if (!(level in console)) {\n      return;\n    }\n\n    var sentryLevel = level === 'warn'\n      ? 'warning'\n      : level;\n\n    console[level] = function () {\n      var args = [].slice.call(arguments);\n\n      var msg = '' + args.join(' ');\n      var data = { level: sentryLevel, logger: 'console', extra: { 'arguments': args } };\n      callback && callback(msg, data);\n\n      // this fails for some browsers. :(\n      if (originalConsoleLevel) {\n        // IE9 doesn't allow calling apply on console functions directly\n        // See: https://stackoverflow.com/questions/5472938/does-ie9-support-console-log-and-is-it-a-real-function#answer-5473193\n        Function.prototype.apply.call(\n          originalConsoleLevel,\n          originalConsole,\n          args\n        );\n      }\n    };\n  };\n\n  /**\n   * 写入面包屑\n   * @private\n   * @param {Trace.BreadCrumb} crumb \n   */\n  private captureBreadcrumb(crumb: Trace.BreadCrumb): void {\n    let _crumb = Object.assign({}, crumb, { timestamp: new Date().getTime() });\n    this.crumbsData.push(_crumb);\n\n    // 超出后删除最先记录的一个\n    if (this.crumbsData.length > this._config.maxBreadcrumbs) {\n      this.crumbsData.shift()\n    }\n  }\n}","export const environment: Trace.Environment = {\n  /** 屏幕宽度 */\n  screenWidth: (document.documentElement ? document.documentElement.clientWidth : document.body.clientWidth),\n  /** 屏幕高度 */\n  screenHeigth: (document.documentElement ? document.documentElement.clientHeight : document.body.clientHeight),\n  /** 浏览器信息 */\n  userAgent: navigator.userAgent,\n  /** 浏览器语言 */\n  language: navigator.language\n}\n","import { BreadCrumbs } from './breadcrumbs';\nimport { Exception } from './exception';\nimport { environment } from './environment';\nimport { makeRequest } from './request';\nimport { triggerEvent, guid } from './util';\n// import Tracekit from './tracekit';\n\nexport class Report {\n  private config: Trace.Config;\n  // private Tracekit = Tracekit;\n  private breadcrumbs: BreadCrumbs;\n\n  private lastGuid: string = null;\n  private lastReport: Trace.Report = null;\n\n  constructor(config: Trace.Config) {\n    this.config = config;\n    // Tracekit['report'].subscribe((errorReport: any) => {\n    //   this.handleStackInfo(errorReport)\n    // })\n    // const exception = new Exception();\n    // exception.handleWindowOnError();\n    // console.log(exception.stackInfo)\n    // setTimeout(() => console.log(exception.stackInfo), 1000);\n    // this.handleStackInfo(exception.stackInfo);\n    this.breadcrumbs = new BreadCrumbs(config);\n  }\n\n  /**\n   * 处理栈信息\n   * @private\n   * @param {Trace.StackInfo} stackInfo TraceKit获取的栈信息\n   */\n  public handleStackInfo(stackInfo: Trace.StackInfo): void {\n    let frames: Array<Trace.StackFrame> = this.prepareFrames(stackInfo);\n\n    triggerEvent('handle', { stackInfo });\n    const { type, message, url, lineNumber, columnNumber } = stackInfo;\n    this.handleException(type, message, url, lineNumber, columnNumber, frames)\n  }\n\n  /**\n   * 处理报告数据\n   * @private\n   * @param {Trace.CatchedException} exception \n   */\n  public handlePayload(exception: Trace.CatchedException) {\n    // 合并报告\n    const reportData: Trace.Report = {\n      url: location.href,\n      title: document.title,\n      environment,\n      exception,\n      version: this.config.version,\n      apiKey: this.config.apiKey,\n      timestamp: new Date().getTime(),\n      guid: guid(),\n      breadcrumbs: this.breadcrumbs.crumbsData,\n    }\n    // 发送报告\n    this.sendPayload(reportData)\n  }\n\n  /**\n   * 设置栈帧数据集长度\n   * @private\n   * @param {Trace.StackInfo} stackInfo TraceKit获取的栈信息\n   * @returns {Trace.StackFrame[]} \n   */\n  public prepareFrames(stackInfo: Trace.StackInfo): Trace.StackFrame[] {\n    const { stacktrace } = stackInfo\n    let frames: Array<Trace.StackFrame> = [];\n    if (stacktrace.frames && stacktrace.frames.length) {\n      stacktrace.frames.forEach(item => {\n        frames.push(item)\n      });\n    }\n    frames = frames.slice(0, this.config.maxStackDepth);\n    return frames;\n  }\n\n  /**\n   * Handle exception\n   * @param {string} type \n   * @param {string} message \n   * @param {string} url \n   * @param {number} lineno \n   * @param {Array<Trace.StackFrame>} frames \n   * @returns {void} \n   */\n  private handleException(type: string, message: string, fileName: string, lineNumber: number, columnNumber: number, frames: Array<Trace.StackFrame>): void {\n    let config = this.config;\n    let stacktrace: Trace.StackTrace;\n    if (!!(config.ignoreErrors as RegExp).test && (config.ignoreErrors as RegExp).test(message)) return;\n\n    message += '';\n\n    if (frames && frames.length) {\n      fileName = frames[0].fileName || fileName;\n      frames.reverse(); // 倒序排列\n      stacktrace = { frames };\n    } else if (fileName) {\n      stacktrace = {\n        frames: [{ fileName, lineNumber, columnNumber }]\n      }\n    }\n    if (!!(config.ignoreUrls as RegExp).test && (config.ignoreUrls as RegExp).test(fileName)) return;\n    let exception: Trace.CatchedException = {\n      type,\n      message,\n      stacktrace\n    }\n    // 处理报告数据\n    this.handlePayload(exception);\n  }\n\n  /**\n   * 发送报告\n   * @private\n   * @param {Trace.Report} payload\n   */\n  private sendPayload(payload: Trace.Report) {\n    this.lastGuid = payload.guid;\n    if (!this.config.repeatReport && this.isRepeatReport(payload)) return;\n\n    this.lastReport = payload;\n    const requestOptions = {\n      url: this.config.exceptionUrl,\n      data: payload,\n      onSuccess: () => {\n        triggerEvent('success', {\n          data: payload,\n          src: this.config.exceptionUrl\n        })\n        return new Promise(() => { });\n      },\n      OnError: (error) => {\n        triggerEvent('failure', {\n          data: payload,\n          src: this.config.exceptionUrl\n        })\n        error = error || new Error(`Trace: report sending failed!`);\n        return new Promise(resolve => resolve(error))\n      }\n    }\n    // 发送报告请求\n    makeRequest(requestOptions);\n  }\n\n  /**\n   * 判断两份报告是否重复\n   * @private\n   * @param {Trace.Report} current \n   * @returns {boolean} \n   */\n  private isRepeatReport(current: Trace.Report): boolean {\n    const last = this.lastReport;\n\n    // 如果最后一次报告没有或者两个 report 的 URL 都不相同直接返回 false\n    if (!last || current.url !== last.url) return false;\n\n    if (current.exception || last.exception) {\n      return this.isSameException(current.exception, last.exception);\n    }\n    return true;\n  }\n\n  /**\n   * 判断两个异常数据集是否重复\n   * @private\n   * @param {Trace.CatchedException[]} arrayEx1 \n   * @param {Trace.CatchedException[]} arrayEx2 \n   * @returns {boolean} \n   */\n  private isSameException(arrayEx1: Trace.CatchedException, arrayEx2: Trace.CatchedException): boolean {\n    if (!arrayEx1 || !arrayEx2) return false;\n\n    const ex1: Trace.CatchedException = arrayEx1;\n    const ex2: Trace.CatchedException = arrayEx2;\n\n    if (ex1.type !== ex2.type || ex1.message !== ex2.message) return false;\n\n    return this.isSameStacktrace(ex1.stacktrace.frames, ex2.stacktrace.frames);\n  }\n\n  /**\n   * 判断两个栈帧数据集是否重复\n   * @private\n   * @param {Trace.StackFrame[]} stacktrace1 \n   * @param {Trace.StackFrame[]} stacktrace2 \n   * @returns {boolean} \n   */\n  private isSameStacktrace(stacktrace1: Trace.StackFrame[], stacktrace2: Trace.StackFrame[]): boolean {\n    if (!stacktrace1.length || !stacktrace2.length) return false;\n\n    stacktrace1.forEach((item, index) => {\n      if (item.fileName !== stacktrace2[index].fileName ||\n        item.columnNumber !== stacktrace2[index].columnNumber ||\n        item.lineNumber !== stacktrace2[index].lineNumber ||\n        item.func !== stacktrace2[index].func) return false;\n    })\n\n    return true;\n  }\n}\n","import { Report } from './report';\n\n/**\n * Most of all are borrowed from Tracekit\n * @see https://github.com/occ/TraceKit\n * @class Exception\n */\nexport class Exception {\n  private originOnError: ErrorEventHandler = window.onerror;\n  private report: Report;\n\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Error_types\n  private ERROR_TYPES: RegExp = /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;\n\n  constructor(config: Trace.Config) {\n    this.handleWindowOnError();\n    this.report = new Report(config);\n  }\n\n  private handleWindowOnError() {\n    let self = this;\n    let stackInfo: Trace.StackInfo = null;\n\n    window.onerror = function (message: string, fileName: string, lineNumber: number, columnNumber: number, error: Error) {\n      if (error) {\n        stackInfo = self.analyzeErrorStack(error);\n      } else {\n        const frame: Trace.StackFrame = { fileName, lineNumber, columnNumber, func: '?' };\n        let type, msg = message;\n        if (Object.prototype.toString.call(message) === '[object String]') {\n          // example: ['Uncaught TypeError: blah blah blah', 'TypeError' 'blah blah blah']\n          const msgGroup: Array<string> = message.match(self.ERROR_TYPES);\n          if (msgGroup) {\n            type = msgGroup[1];\n            msg = msgGroup[2];\n          }\n        }\n\n        // set exception data\n        stackInfo = {\n          type,\n          message: msg,\n          lineNumber,\n          columnNumber,\n          stacktrace: {\n            frames: [frame]\n          }\n        }\n      }\n\n      // apply original window.onerror\n      self.originOnError && self.originOnError.apply(window, arguments);\n      self.report.handleStackInfo(stackInfo);\n      // for console\n      return false;\n    }\n  }\n\n  /**\n   * Analyze stack information from Error object\n   * @param {Error} error \n   * @param {number} [depth] \n   */\n  public analyzeErrorStack(error: Error, depth?: number): Trace.StackInfo {\n    const { name, message } = error;\n    depth = (depth == null ? 0 : +depth);\n    let stackInfo: Trace.StackInfo;\n\n    try {\n      stackInfo = this.analyzeStackFromProp(error);\n      if (stackInfo) return stackInfo;\n    } catch (e) { }\n\n    try {\n      stackInfo = this.analyzeStackFromCaller(error, depth + 1);\n      if (stackInfo) return stackInfo;\n    } catch (e) { }\n\n    return {\n      type: name,\n      message,\n      url: window.location.href\n    }\n  }\n\n  /**\n   * Analyze stack from error object properties\n   * @param {Error} error \n   * @returns {Trace.StackInfo} \n   * @memberof Exception\n   */\n  private analyzeStackFromProp(error: Error): Trace.StackInfo {\n    const { name, stack, message } = error;\n    if (typeof stack === 'undefined' || !stack) return;\n\n    const chrome = /^\\s*at (.*?) ?\\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i;\n    const gecko = /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\\[native).*?)(?::(\\d+))?(?::(\\d+))?\\s*$/i;\n    const winjs = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i;\n\n    const chromeEval = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/;\n    const geckoEval = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i;\n    const lines = stack.split('\\n');\n    const reference = /^(.*) is undefined$/.exec(message);\n\n    let frames: Array<Trace.StackFrame> = [], submatch, parts, element: Trace.StackFrame;\n\n    for (let i = 0, j = lines.length; i < j; ++i) {\n      if ((parts = chrome.exec(lines[i]))) {\n        const isNative = parts[2] && parts[2].indexOf('native') === 0; // start of line\n        const isEval = parts[2] && parts[2].indexOf('eval') === 0; // start of line\n        if (isEval && (submatch = chromeEval.exec(parts[2]))) {\n          // throw out eval line/column and use top-most line/column number\n          parts[2] = submatch[1]; // url\n          parts[3] = submatch[2]; // line\n          parts[4] = submatch[3]; // column\n        }\n        element = {\n          fileName: !isNative ? parts[2] : null,\n          func: parts[1] || '?',\n          args: isNative ? [parts[2]] : [],\n          lineNumber: parts[3] ? +parts[3] : null,\n          columnNumber: parts[4] ? +parts[4] : null\n        };\n      } else if (parts = winjs.exec(lines[i])) {\n        element = {\n          fileName: parts[2],\n          func: parts[1] || '?',\n          args: [],\n          lineNumber: +parts[3],\n          columnNumber: parts[4] ? +parts[4] : null\n        };\n      } else if ((parts = gecko.exec(lines[i]))) {\n        var isEval = parts[3] && parts[3].indexOf(' > eval') > -1;\n        if (isEval && (submatch = geckoEval.exec(parts[3]))) {\n          // throw out eval line/column and use top-most line number\n          parts[3] = submatch[1];\n          parts[4] = submatch[2];\n          parts[5] = null; // no column when eval\n        } else if (i === 0 && !parts[5] && typeof (error as any).columnNumber !== 'undefined') {\n          // FireFox uses this awesome columnNumber property for its top frame\n          // Also note, Firefox's column number is 0-based and everything else expects 1-based,\n          // so adding 1\n          // NOTE: this hack doesn't work if top-most frame is eval\n          frames[0].columnNumber = (error as any).columnNumber + 1;\n        }\n        element = {\n          fileName: parts[3],\n          func: parts[1] || '?',\n          args: parts[2] ? parts[2].split(',') : [],\n          lineNumber: parts[4] ? +parts[4] : null,\n          columnNumber: parts[5] ? +parts[5] : null\n        };\n      } else {\n        continue;\n      }\n\n      if (!element.func && element.lineNumber) element.func = '?';\n      if (element.args.length === 0) delete element.args;\n      frames.push(element);\n    }\n\n    if (!frames.length) return null;\n\n    return {\n      type: name,\n      message,\n      stacktrace: {\n        frames\n      }\n    };\n  }\n\n  /**\n   * Analyze stack from arguments.caller chain\n   * @param {Error} error \n   * @param {number} depth \n   * @returns {Trace.StackInfo} \n   */\n  private analyzeStackFromCaller(error: Error, depth: number): Trace.StackInfo {\n    const { name, message } = error;\n    const functionName = /function\\s+([_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(/i;\n\n    let frames: Array<Trace.StackFrame> = [], funcs = {}, recursion = false, parts, frame: Trace.StackFrame, source;\n\n    for (let curr = this.analyzeStackFromCaller.caller; curr && !recursion; curr = curr.caller) {\n      if (curr === this.analyzeStackFromProp) {\n        continue;\n      }\n\n      frame = {\n        fileName: null,\n        func: '?',\n        lineNumber: null,\n        columnNumber: null\n      };\n\n      if (curr.name) {\n        frame.func = curr.name;\n      } else if ((parts = functionName.exec(curr.toString()))) {\n        frame.func = parts[1];\n      }\n\n      typeof frame.func === 'undefined' && (frame.func = (parts.input as string).substring(0, parts.indexOf('{')));\n\n      funcs['' + curr] ? recursion = true : funcs['' + curr] = true;\n\n      frames.push(frame);\n    }\n\n    depth && frames.splice(0, depth);\n\n    let stackInfo: Trace.StackInfo = {\n      type: name,\n      message,\n      stacktrace: { frames }\n    }\n\n    const err: any = error;\n    this.analyzeFirstFrame(stackInfo, err.sourceURL || err.fileName, err.line || err.lineNumber, err.message || err.description)\n\n    return stackInfo;\n  }\n\n  /**\n   * Adds information about the first frame to incomplete stack traces.\n   * Safari and IE require this to get complete data on the first frame.\n   * @param {*} stackInfo \n   * @param {string} url \n   * @param {number} line \n   * @param {string} message \n   * @returns {boolean} \n   */\n  private analyzeFirstFrame(stackInfo: any, url: string, line: number, message: string): boolean {\n    let initial = { url, line, func: '?' };\n\n    if (initial.url && initial.line) {\n      stackInfo.incomplete = false;\n\n      if (stackInfo.stack.length > 0) {\n        if (stackInfo.stack[0].url === initial.url) {\n          if (stackInfo.stack[0].line === initial.line) {\n            return false; // already in stack trace\n          } else if (!stackInfo.stack[0].line && stackInfo.stack[0].func === initial.func) {\n            stackInfo.stack[0].line = initial.line;\n            return false;\n          }\n        }\n      }\n\n      stackInfo.stack.unshift(initial);\n      stackInfo.partial = true;\n      return true;\n    } else {\n      stackInfo.incomplete = true;\n    }\n\n    return false;\n  }\n}","import { defaultConfig } from './config';\nimport { Report } from './report';\nimport { joinRegExp, isError } from './util';\nimport Tracekit from './tracekit';\nimport Perf from './performance';\nimport { Exception } from './exception';\n\nexport default class Trace {\n  // private computeStackTrace: TraceKit.ComputeStackTrace = Tracekit['computeStackTrace'];\n  private analyzeErrorStack;\n  private globalConfig: Trace.Config = defaultConfig;\n  private report: Report;\n\n  public config(config?: Trace.Config) {\n    this.globalConfig = Object.assign({}, this.globalConfig, config);\n    this.processConfig();\n    this.report = new Report(this.globalConfig);\n    this.analyzeErrorStack = new Exception(this.globalConfig).analyzeErrorStack;\n    window.addEventListener('beforeunload', () => {\n      const perf = new Perf(this.globalConfig);\n      perf.payloadSending();\n    });\n  }\n\n  public captureException(exception: Error): void {\n    if (!isError(exception)) {\n      return this.captureMessage(exception as any);\n    }\n\n    try {\n      const stackInfo: Trace.StackInfo = this.analyzeErrorStack(exception);\n      this.report.handleStackInfo(stackInfo);\n    } catch (e) {\n      if (exception !== e) throw e;\n    }\n  }\n\n  public captureMessage(message: string): void {\n    if (!!(this.globalConfig.ignoreErrors as RegExp).test\n      && (this.globalConfig.ignoreErrors as RegExp).test(message)) return;\n\n    let exception: any;\n    try {\n      throw new Error(message);\n    } catch (e) {\n      exception = e;\n    }\n\n    let stackInfo = this.analyzeErrorStack(exception);\n    let frames: Trace.StackFrame[] = this.report.prepareFrames(stackInfo);\n\n    let catchedException: Trace.CatchedException = {\n      stacktrace: { frames },\n      message\n    }\n\n    this.report.handlePayload(catchedException);\n  }\n\n  private processConfig() {\n    const ignoreErrors = this.globalConfig.ignoreErrors as Array<RegExp>;\n    const ignoreUrls = this.globalConfig.ignoreErrors as Array<RegExp>;\n\n    ignoreErrors.push(/^Script error\\.?$/);\n    ignoreErrors.push(/^Javascript error: Script error\\.? on line 0$/);\n    this.globalConfig.ignoreErrors = joinRegExp(ignoreErrors);\n\n    this.globalConfig.ignoreUrls = ignoreUrls.length && joinRegExp(ignoreUrls);\n  }\n}\n"],"names":["defaultConfig","value","Object","prototype","toString","call","Error","crypto","window","getRandomValues","arr","Uint16Array","pad","num","v","length","replace","c","r","Math","random","eventType","options","document","_event","key","substr","toUpperCase","createEvent","initEvent","hasOwnProperty","dispatchEvent","toLowerCase","obj","name","replacement","track","origin","push","func","undefined","trace","track_wrapper","e","inner","args","i","arguments","deep","apply","wrap","property","process","wrapped","patterns","sources","pattern","source","RegExp","join","element","MAX_TRAVERSE_HEIGHT","MAX_OUTPUT_LEN","out","height","len","separator","sepLength","nextStr","htmlElementAsString","parentElement","reverse","className","classes","attr","tagName","id","split","attrWhitelist","getAttribute","url","match","query","fragment","result","attributes","item","request","XMLHttpRequest","hasCORS","onreadystatechange","readyState","status","onSuccess","onError","error","XDomainRequest","onload","onerror","open","send","JSON","stringify","data","config","getCollection","collection","navigator","sendBeacon","log","performanceUrl","requestOptions","Promise","resolve","performance","timing","navigation","resource","getEntriesByType","redirect","redirectEnd","redirectStart","dns","domainLookupEnd","domainLookupStart","tcp","connectEnd","connectStart","tls","secureConnectionStart","firstPaint","responseStart","navigationStart","network","responseEnd","dom","domComplete","firstScreen","domContentLoadedEventEnd","interactive","domInteractive","pageLoad","loadEventStart","redirectCount","navigationType","type","resources","forEach","initiatorType","duration","transferSize","toFixed","userAgent","location","href","protocol","apiKey","host","_config","getDomBreadcrumbs","getXhrBreadcrumbs","getLocationBreadcurmbs","getConsoleBreadcrumbs","autoBreadcrumbs","clickEventSelectors","changeEventSelectors","addEventListener","event","eventHandler","eventName","selectorFilters","target","srcElement","acceptTag","getAttributes","inputElement","htmlTreeAsString","captureBreadcrumb","selectors","tag","indexOf","xhr","self","wrappedBuiltIns","xhrproto","prop","origOpen","method","_trace_xhr","origSend","statusCode","props","j","onreadystatechangeHandler","chrome","isChromePackagedApp","app","runtime","hasPushState","history","pushState","oldOnPopState","onpopstate","currentHref","captureUrlChange","lastHref","origPushState","from","to","parsedLoc","parseUrl","parsedTo","parsedFrom","relative","perf","Perf","payloadSending","console","consoleMethodCallback","msg","level","wrapConsole","callback","originalConsoleLevel","originalConsole","sentryLevel","slice","logger","extra","crumb","_crumb","assign","timestamp","Date","getTime","crumbsData","maxBreadcrumbs","shift","environment","documentElement","clientWidth","body","clientHeight","language","breadcrumbs","BreadCrumbs","stackInfo","frames","prepareFrames","message","lineNumber","columnNumber","handleException","exception","reportData","title","version","guid","sendPayload","stacktrace","maxStackDepth","fileName","ignoreErrors","test","ignoreUrls","handlePayload","payload","lastGuid","repeatReport","isRepeatReport","lastReport","exceptionUrl","current","last","isSameException","arrayEx1","arrayEx2","ex1","ex2","isSameStacktrace","stacktrace1","stacktrace2","index","handleWindowOnError","report","Report","analyzeErrorStack","frame","msgGroup","ERROR_TYPES","originOnError","handleStackInfo","depth","analyzeStackFromProp","analyzeStackFromCaller","stack","gecko","winjs","chromeEval","geckoEval","lines","reference","exec","submatch","parts","isNative","isEval","functionName","funcs","recursion","curr","caller","input","substring","splice","err","analyzeFirstFrame","sourceURL","line","description","initial","incomplete","unshift","partial","globalConfig","processConfig","Exception","isError","captureMessage","catchedException","joinRegExp"],"mappings":"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"}