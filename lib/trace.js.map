{"version":3,"file":"trace.js","sources":["../src/config.ts","../src/tracekit.js","../src/request.ts","../src/environment.ts","../src/util.ts","../src/breadcrumbs.ts","../src/onError.ts","../src/index.ts"],"sourcesContent":["\r\nexport const defaultConfig: Trace.Config = {\r\n  apiKey: '',\r\n  enabled: true,\r\n  reportUrl: 'http://localhost:3001/tracer/error',\r\n  ignoreErrors: [],\r\n  ignoreUrls: [],\r\n  autoBreadcrumbs: {\r\n    dom: true,\r\n    xhr: true,\r\n    location: true,\r\n    console: false\r\n  },\r\n  releaseStage: 'production',\r\n  catchAjax: true,\r\n  catchConsole: true,\r\n  disableLog: false,\r\n  maxStackDepth: 10,\r\n  repeatReport: false,\r\n  maxBreadcrumbs: 100\r\n}\r\n","'use strict';\r\n\r\n/*\r\n TraceKit - Cross brower stack traces\r\n\r\n This was originally forked from github.com/occ/TraceKit, but has since been\r\n largely re-written and is now maintained as part of raven-js.  Tests for\r\n this are in test/vendor.\r\n\r\n MIT license\r\n*/\r\n\r\nvar TraceKit = {\r\n    collectWindowErrors: true,\r\n    debug: false\r\n};\r\n\r\n// This is to be defensive in environments where window does not exist (see https://github.com/getsentry/raven-js/pull/785)\r\nvar _window = typeof window !== 'undefined' ? window\r\n            : typeof global !== 'undefined' ? global\r\n            : typeof self !== 'undefined' ? self\r\n            : {};\r\n\r\n// global reference to slice\r\nvar _slice = [].slice;\r\nvar UNKNOWN_FUNCTION = '?';\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Error_types\r\nvar ERROR_TYPES_RE = /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;\r\n\r\nfunction getLocationHref() {\r\n    if (typeof document === 'undefined' || typeof document.location === 'undefined')\r\n        return '';\r\n\r\n    return document.location.href;\r\n}\r\n\r\n\r\n/**\r\n * TraceKit.report: cross-browser processing of unhandled exceptions\r\n *\r\n * Syntax:\r\n *   TraceKit.report.subscribe(function(stackInfo) { ... })\r\n *   TraceKit.report.unsubscribe(function(stackInfo) { ... })\r\n *   TraceKit.report(exception)\r\n *   try { ...code... } catch(ex) { TraceKit.report(ex); }\r\n *\r\n * Supports:\r\n *   - Firefox: full stack trace with line numbers, plus column number\r\n *              on top frame; column number is not guaranteed\r\n *   - Opera:   full stack trace with line and column numbers\r\n *   - Chrome:  full stack trace with line and column numbers\r\n *   - Safari:  line and column number for the top frame only; some frames\r\n *              may be missing, and column number is not guaranteed\r\n *   - IE:      line and column number for the top frame only; some frames\r\n *              may be missing, and column number is not guaranteed\r\n *\r\n * In theory, TraceKit should work on all of the following versions:\r\n *   - IE5.5+ (only 8.0 tested)\r\n *   - Firefox 0.9+ (only 3.5+ tested)\r\n *   - Opera 7+ (only 10.50 tested; versions 9 and earlier may require\r\n *     Exceptions Have Stacktrace to be enabled in opera:config)\r\n *   - Safari 3+ (only 4+ tested)\r\n *   - Chrome 1+ (only 5+ tested)\r\n *   - Konqueror 3.5+ (untested)\r\n *\r\n * Requires TraceKit.computeStackTrace.\r\n *\r\n * Tries to catch all unhandled exceptions and report them to the\r\n * subscribed handlers. Please note that TraceKit.report will rethrow the\r\n * exception. This is REQUIRED in order to get a useful stack trace in IE.\r\n * If the exception does not reach the top of the browser, you will only\r\n * get a stack trace from the point where TraceKit.report was called.\r\n *\r\n * Handlers receive a stackInfo object as described in the\r\n * TraceKit.computeStackTrace docs.\r\n */\r\nTraceKit.report = (function reportModuleWrapper() {\r\n    var handlers = [],\r\n        lastArgs = null,\r\n        lastException = null,\r\n        lastExceptionStack = null;\r\n\r\n    /**\r\n     * Add a crash handler.\r\n     * @param {Function} handler\r\n     */\r\n    function subscribe(handler) {\r\n        installGlobalHandler();\r\n        handlers.push(handler);\r\n    }\r\n\r\n    /**\r\n     * Remove a crash handler.\r\n     * @param {Function} handler\r\n     */\r\n    function unsubscribe(handler) {\r\n        for (var i = handlers.length - 1; i >= 0; --i) {\r\n            if (handlers[i] === handler) {\r\n                handlers.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove all crash handlers.\r\n     */\r\n    function unsubscribeAll() {\r\n        uninstallGlobalHandler();\r\n        handlers = [];\r\n    }\r\n\r\n    /**\r\n     * Dispatch stack information to all handlers.\r\n     * @param {Object.<string, *>} stack\r\n     */\r\n    function notifyHandlers(stack, isWindowError) {\r\n        var exception = null;\r\n        if (isWindowError && !TraceKit.collectWindowErrors) {\r\n          return;\r\n        }\r\n        for (var i in handlers) {\r\n            if (handlers.hasOwnProperty(i)) {\r\n                try {\r\n                    handlers[i].apply(null, [stack].concat(_slice.call(arguments, 2)));\r\n                } catch (inner) {\r\n                    exception = inner;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (exception) {\r\n            throw exception;\r\n        }\r\n    }\r\n\r\n    var _oldOnerrorHandler, _onErrorHandlerInstalled;\r\n\r\n    /**\r\n     * Ensures all global unhandled exceptions are recorded.\r\n     * Supported by Gecko and IE.\r\n     * @param {string} message Error message.\r\n     * @param {string} url URL of script that generated the exception.\r\n     * @param {(number|string)} lineNo The line number at which the error\r\n     * occurred.\r\n     * @param {?(number|string)} colNo The column number at which the error\r\n     * occurred.\r\n     * @param {?Error} ex The actual Error object.\r\n     */\r\n    function traceKitWindowOnError(message, url, lineNo, colNo, ex) {\r\n        var stack = null;\r\n\r\n        if (lastExceptionStack) {\r\n            TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack, url, lineNo, message);\r\n            processLastException();\r\n        } else if (ex) {\r\n            // non-string `ex` arg; attempt to extract stack trace\r\n\r\n            // New chrome and blink send along a real error object\r\n            // Let's just report that like a normal error.\r\n            // See: https://mikewest.org/2013/08/debugging-runtime-errors-with-window-onerror\r\n            stack = TraceKit.computeStackTrace(ex);\r\n            notifyHandlers(stack, true);\r\n        } else {\r\n            var location = {\r\n                'url': url,\r\n                'line': lineNo,\r\n                'column': colNo\r\n            };\r\n\r\n            var name = undefined;\r\n            var msg = message; // must be new var or will modify original `arguments`\r\n            var groups;\r\n            if ({}.toString.call(message) === '[object String]') {\r\n                var groups = message.match(ERROR_TYPES_RE);\r\n                if (groups) {\r\n                    name = groups[1];\r\n                    msg = groups[2];\r\n                }\r\n            }\r\n\r\n            location.func = UNKNOWN_FUNCTION;\r\n\r\n            stack = {\r\n                'name': name,\r\n                'message': msg,\r\n                'url': getLocationHref(),\r\n                'stack': [location]\r\n            };\r\n            notifyHandlers(stack, true);\r\n        }\r\n\r\n        if (_oldOnerrorHandler) {\r\n            return _oldOnerrorHandler.apply(this, arguments);\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    function installGlobalHandler ()\r\n    {\r\n        if (_onErrorHandlerInstalled) {\r\n            return;\r\n        }\r\n        _oldOnerrorHandler = _window.onerror;\r\n        _window.onerror = traceKitWindowOnError;\r\n        _onErrorHandlerInstalled = true;\r\n    }\r\n\r\n    function uninstallGlobalHandler ()\r\n    {\r\n        if (!_onErrorHandlerInstalled) {\r\n            return;\r\n        }\r\n        _window.onerror = _oldOnerrorHandler;\r\n        _onErrorHandlerInstalled = false;\r\n        _oldOnerrorHandler = undefined;\r\n    }\r\n\r\n    function processLastException() {\r\n        var _lastExceptionStack = lastExceptionStack,\r\n            _lastArgs = lastArgs;\r\n        lastArgs = null;\r\n        lastExceptionStack = null;\r\n        lastException = null;\r\n        notifyHandlers.apply(null, [_lastExceptionStack, false].concat(_lastArgs));\r\n    }\r\n\r\n    /**\r\n     * Reports an unhandled Error to TraceKit.\r\n     * @param {Error} ex\r\n     * @param {?boolean} rethrow If false, do not re-throw the exception.\r\n     * Only used for window.onerror to not cause an infinite loop of\r\n     * rethrowing.\r\n     */\r\n    function report(ex, rethrow) {\r\n        var args = _slice.call(arguments, 1);\r\n        if (lastExceptionStack) {\r\n            if (lastException === ex) {\r\n                return; // already caught by an inner catch block, ignore\r\n            } else {\r\n              processLastException();\r\n            }\r\n        }\r\n\r\n        var stack = TraceKit.computeStackTrace(ex);\r\n        lastExceptionStack = stack;\r\n        lastException = ex;\r\n        lastArgs = args;\r\n\r\n        // If the stack trace is incomplete, wait for 2 seconds for\r\n        // slow slow IE to see if onerror occurs or not before reporting\r\n        // this exception; otherwise, we will end up with an incomplete\r\n        // stack trace\r\n        setTimeout(function () {\r\n            if (lastException === ex) {\r\n                processLastException();\r\n            }\r\n        }, (stack.incomplete ? 2000 : 0));\r\n\r\n        if (rethrow !== false) {\r\n            throw ex; // re-throw to propagate to the top level (and cause window.onerror)\r\n        }\r\n    }\r\n\r\n    report.subscribe = subscribe;\r\n    report.unsubscribe = unsubscribe;\r\n    report.uninstall = unsubscribeAll;\r\n    return report;\r\n}());\r\n\r\n/**\r\n * TraceKit.computeStackTrace: cross-browser stack traces in JavaScript\r\n *\r\n * Syntax:\r\n *   s = TraceKit.computeStackTrace(exception) // consider using TraceKit.report instead (see below)\r\n * Returns:\r\n *   s.name              - exception name\r\n *   s.message           - exception message\r\n *   s.stack[i].url      - JavaScript or HTML file URL\r\n *   s.stack[i].func     - function name, or empty for anonymous functions (if guessing did not work)\r\n *   s.stack[i].args     - arguments passed to the function, if known\r\n *   s.stack[i].line     - line number, if known\r\n *   s.stack[i].column   - column number, if known\r\n *\r\n * Supports:\r\n *   - Firefox:  full stack trace with line numbers and unreliable column\r\n *               number on top frame\r\n *   - Opera 10: full stack trace with line and column numbers\r\n *   - Opera 9-: full stack trace with line numbers\r\n *   - Chrome:   full stack trace with line and column numbers\r\n *   - Safari:   line and column number for the topmost stacktrace element\r\n *               only\r\n *   - IE:       no line numbers whatsoever\r\n *\r\n * Tries to guess names of anonymous functions by looking for assignments\r\n * in the source code. In IE and Safari, we have to guess source file names\r\n * by searching for function bodies inside all page scripts. This will not\r\n * work for scripts that are loaded cross-domain.\r\n * Here be dragons: some function names may be guessed incorrectly, and\r\n * duplicate functions may be mismatched.\r\n *\r\n * TraceKit.computeStackTrace should only be used for tracing purposes.\r\n * Logging of unhandled exceptions should be done with TraceKit.report,\r\n * which builds on top of TraceKit.computeStackTrace and provides better\r\n * IE support by utilizing the window.onerror event to retrieve information\r\n * about the top of the stack.\r\n *\r\n * Note: In IE and Safari, no stack trace is recorded on the Error object,\r\n * so computeStackTrace instead walks its *own* chain of callers.\r\n * This means that:\r\n *  * in Safari, some methods may be missing from the stack trace;\r\n *  * in IE, the topmost function in the stack trace will always be the\r\n *    caller of computeStackTrace.\r\n *\r\n * This is okay for tracing (because you are likely to be calling\r\n * computeStackTrace from the function you want to be the topmost element\r\n * of the stack trace anyway), but not okay for logging unhandled\r\n * exceptions (because your catch block will likely be far away from the\r\n * inner function that actually caused the exception).\r\n *\r\n */\r\nTraceKit.computeStackTrace = (function computeStackTraceWrapper() {\r\n    // Contents of Exception in various browsers.\r\n    //\r\n    // SAFARI:\r\n    // ex.message = Can't find variable: qq\r\n    // ex.line = 59\r\n    // ex.sourceId = 580238192\r\n    // ex.sourceURL = http://...\r\n    // ex.expressionBeginOffset = 96\r\n    // ex.expressionCaretOffset = 98\r\n    // ex.expressionEndOffset = 98\r\n    // ex.name = ReferenceError\r\n    //\r\n    // FIREFOX:\r\n    // ex.message = qq is not defined\r\n    // ex.fileName = http://...\r\n    // ex.lineNumber = 59\r\n    // ex.columnNumber = 69\r\n    // ex.stack = ...stack trace... (see the example below)\r\n    // ex.name = ReferenceError\r\n    //\r\n    // CHROME:\r\n    // ex.message = qq is not defined\r\n    // ex.name = ReferenceError\r\n    // ex.type = not_defined\r\n    // ex.arguments = ['aa']\r\n    // ex.stack = ...stack trace...\r\n    //\r\n    // INTERNET EXPLORER:\r\n    // ex.message = ...\r\n    // ex.name = ReferenceError\r\n    //\r\n    // OPERA:\r\n    // ex.message = ...message... (see the example below)\r\n    // ex.name = ReferenceError\r\n    // ex.opera#sourceloc = 11  (pretty much useless, duplicates the info in ex.message)\r\n    // ex.stacktrace = n/a; see 'opera:config#UserPrefs|Exceptions Have Stacktrace'\r\n\r\n    /**\r\n     * Computes stack trace information from the stack property.\r\n     * Chrome and Gecko use this property.\r\n     * @param {Error} ex\r\n     * @return {?Object.<string, *>} Stack trace information.\r\n     */\r\n    function computeStackTraceFromStackProp(ex) {\r\n        if (typeof ex.stack === 'undefined' || !ex.stack) return;\r\n\r\n        var chrome = /^\\s*at (.*?) ?\\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i,\r\n            gecko = /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\\[native).*?)(?::(\\d+))?(?::(\\d+))?\\s*$/i,\r\n            winjs = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i,\r\n\r\n            // Used to additionally parse URL/line/column from eval frames\r\n            geckoEval = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i,\r\n            chromeEval = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/,\r\n\r\n            lines = ex.stack.split('\\n'),\r\n            stack = [],\r\n            submatch,\r\n            parts,\r\n            element,\r\n            reference = /^(.*) is undefined$/.exec(ex.message);\r\n\r\n        for (var i = 0, j = lines.length; i < j; ++i) {\r\n            if ((parts = chrome.exec(lines[i]))) {\r\n                var isNative = parts[2] && parts[2].indexOf('native') === 0; // start of line\r\n                var isEval = parts[2] && parts[2].indexOf('eval') === 0; // start of line\r\n                if (isEval && (submatch = chromeEval.exec(parts[2]))) {\r\n                    // throw out eval line/column and use top-most line/column number\r\n                    parts[2] = submatch[1]; // url\r\n                    parts[3] = submatch[2]; // line\r\n                    parts[4] = submatch[3]; // column\r\n                }\r\n                element = {\r\n                    'url': !isNative ? parts[2] : null,\r\n                    'func': parts[1] || UNKNOWN_FUNCTION,\r\n                    'args': isNative ? [parts[2]] : [],\r\n                    'line': parts[3] ? +parts[3] : null,\r\n                    'column': parts[4] ? +parts[4] : null\r\n                };\r\n            } else if ( parts = winjs.exec(lines[i]) ) {\r\n                element = {\r\n                    'url': parts[2],\r\n                    'func': parts[1] || UNKNOWN_FUNCTION,\r\n                    'args': [],\r\n                    'line': +parts[3],\r\n                    'column': parts[4] ? +parts[4] : null\r\n                };\r\n            } else if ((parts = gecko.exec(lines[i]))) {\r\n                var isEval = parts[3] && parts[3].indexOf(' > eval') > -1;\r\n                if (isEval && (submatch = geckoEval.exec(parts[3]))) {\r\n                    // throw out eval line/column and use top-most line number\r\n                    parts[3] = submatch[1];\r\n                    parts[4] = submatch[2];\r\n                    parts[5] = null; // no column when eval\r\n                } else if (i === 0 && !parts[5] && typeof ex.columnNumber !== 'undefined') {\r\n                    // FireFox uses this awesome columnNumber property for its top frame\r\n                    // Also note, Firefox's column number is 0-based and everything else expects 1-based,\r\n                    // so adding 1\r\n                    // NOTE: this hack doesn't work if top-most frame is eval\r\n                    stack[0].column = ex.columnNumber + 1;\r\n                }\r\n                element = {\r\n                    'url': parts[3],\r\n                    'func': parts[1] || UNKNOWN_FUNCTION,\r\n                    'args': parts[2] ? parts[2].split(',') : [],\r\n                    'line': parts[4] ? +parts[4] : null,\r\n                    'column': parts[5] ? +parts[5] : null\r\n                };\r\n            } else {\r\n                continue;\r\n            }\r\n\r\n            if (!element.func && element.line) {\r\n                element.func = UNKNOWN_FUNCTION;\r\n            }\r\n\r\n            stack.push(element);\r\n        }\r\n\r\n        if (!stack.length) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            'name': ex.name,\r\n            'message': ex.message,\r\n            'url': getLocationHref(),\r\n            'stack': stack\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Adds information about the first frame to incomplete stack traces.\r\n     * Safari and IE require this to get complete data on the first frame.\r\n     * @param {Object.<string, *>} stackInfo Stack trace information from\r\n     * one of the compute* methods.\r\n     * @param {string} url The URL of the script that caused an error.\r\n     * @param {(number|string)} lineNo The line number of the script that\r\n     * caused an error.\r\n     * @param {string=} message The error generated by the browser, which\r\n     * hopefully contains the name of the object that caused the error.\r\n     * @return {boolean} Whether or not the stack information was\r\n     * augmented.\r\n     */\r\n    function augmentStackTraceWithInitialElement(stackInfo, url, lineNo, message) {\r\n        var initial = {\r\n            'url': url,\r\n            'line': lineNo\r\n        };\r\n\r\n        if (initial.url && initial.line) {\r\n            stackInfo.incomplete = false;\r\n\r\n            if (!initial.func) {\r\n                initial.func = UNKNOWN_FUNCTION;\r\n            }\r\n\r\n            if (stackInfo.stack.length > 0) {\r\n                if (stackInfo.stack[0].url === initial.url) {\r\n                    if (stackInfo.stack[0].line === initial.line) {\r\n                        return false; // already in stack trace\r\n                    } else if (!stackInfo.stack[0].line && stackInfo.stack[0].func === initial.func) {\r\n                        stackInfo.stack[0].line = initial.line;\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            stackInfo.stack.unshift(initial);\r\n            stackInfo.partial = true;\r\n            return true;\r\n        } else {\r\n            stackInfo.incomplete = true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Computes stack trace information by walking the arguments.caller\r\n     * chain at the time the exception occurred. This will cause earlier\r\n     * frames to be missed but is the only way to get any stack trace in\r\n     * Safari and IE. The top frame is restored by\r\n     * {@link augmentStackTraceWithInitialElement}.\r\n     * @param {Error} ex\r\n     * @return {?Object.<string, *>} Stack trace information.\r\n     */\r\n    function computeStackTraceByWalkingCallerChain(ex, depth) {\r\n        var functionName = /function\\s+([_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(/i,\r\n            stack = [],\r\n            funcs = {},\r\n            recursion = false,\r\n            parts,\r\n            item,\r\n            source;\r\n\r\n        for (var curr = computeStackTraceByWalkingCallerChain.caller; curr && !recursion; curr = curr.caller) {\r\n            if (curr === computeStackTrace || curr === TraceKit.report) {\r\n                // console.log('skipping internal function');\r\n                continue;\r\n            }\r\n\r\n            item = {\r\n                'url': null,\r\n                'func': UNKNOWN_FUNCTION,\r\n                'line': null,\r\n                'column': null\r\n            };\r\n\r\n            if (curr.name) {\r\n                item.func = curr.name;\r\n            } else if ((parts = functionName.exec(curr.toString()))) {\r\n                item.func = parts[1];\r\n            }\r\n\r\n            if (typeof item.func === 'undefined') {\r\n              try {\r\n                item.func = parts.input.substring(0, parts.input.indexOf('{'));\r\n              } catch (e) { }\r\n            }\r\n\r\n            if (funcs['' + curr]) {\r\n                recursion = true;\r\n            }else{\r\n                funcs['' + curr] = true;\r\n            }\r\n\r\n            stack.push(item);\r\n        }\r\n\r\n        if (depth) {\r\n            // console.log('depth is ' + depth);\r\n            // console.log('stack is ' + stack.length);\r\n            stack.splice(0, depth);\r\n        }\r\n\r\n        var result = {\r\n            'name': ex.name,\r\n            'message': ex.message,\r\n            'url': getLocationHref(),\r\n            'stack': stack\r\n        };\r\n        augmentStackTraceWithInitialElement(result, ex.sourceURL || ex.fileName, ex.line || ex.lineNumber, ex.message || ex.description);\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Computes a stack trace for an exception.\r\n     * @param {Error} ex\r\n     * @param {(string|number)=} depth\r\n     */\r\n    function computeStackTrace(ex, depth) {\r\n        var stack = null;\r\n        depth = (depth == null ? 0 : +depth);\r\n\r\n        try {\r\n            stack = computeStackTraceFromStackProp(ex);\r\n            if (stack) {\r\n                return stack;\r\n            }\r\n        } catch (e) {\r\n            if (TraceKit.debug) {\r\n                throw e;\r\n            }\r\n        }\r\n\r\n        try {\r\n            stack = computeStackTraceByWalkingCallerChain(ex, depth + 1);\r\n            if (stack) {\r\n                return stack;\r\n            }\r\n        } catch (e) {\r\n            if (TraceKit.debug) {\r\n                throw e;\r\n            }\r\n        }\r\n        return {\r\n            'name': ex.name,\r\n            'message': ex.message,\r\n            'url': getLocationHref()\r\n        };\r\n    }\r\n\r\n    computeStackTrace.augmentStackTraceWithInitialElement = augmentStackTraceWithInitialElement;\r\n    computeStackTrace.computeStackTraceFromStackProp = computeStackTraceFromStackProp;\r\n\r\n    return computeStackTrace;\r\n}());\r\n\r\nexport default TraceKit;\r\n","export function makeRequest(options: any):void {\r\n  let request:XMLHttpRequest = new XMLHttpRequest();\r\n  const hasCORS:boolean = 'withCredentials' in request || typeof XDomainRequest !== 'undefined';\r\n\r\n  if (!hasCORS) return;\r\n\r\n  let url = options.url;\r\n  if ('withCredentials' in request) {\r\n    request.onreadystatechange = () => {\r\n      if (request.readyState !== 4) {\r\n        return;\r\n      } else if (request.status === 200) {\r\n        options.onSuccess = options.onSuccess();\r\n      } else if (options.onError) {\r\n        let error: any = new Error(`Error: ${request.status}`);\r\n        error.request = request;\r\n        options.onError(error);\r\n      }\r\n    }\r\n  } else {\r\n    // xdomainrequest cannot go http -> https (or vice versa),\r\n    // so always use protocol relative\r\n    request = new XDomainRequest();\r\n    url = url.replace(/^https?:/, '');\r\n\r\n    // onreadystatechange not supported by XDomainRequest\r\n    if(options.onSuccess) request.onload = options.onSuccess;\r\n    if(options.onError) {\r\n      request.onerror = () => {\r\n        let error: any = new Error(`Error: XDomainRequest`);\r\n        error.request = request;\r\n        options.onError(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  request.open('POST', url, true);\r\n  request.send(JSON.stringify(options.data));\r\n}\r\n","\r\nexport const environment: Trace.Environment = {\r\n  /** 屏幕宽度 */\r\n  screenWidth: (document.documentElement ? document.documentElement.clientWidth : document.body.clientWidth),\r\n  /** 屏幕高度 */\r\n  screenHeigth: (document.documentElement ? document.documentElement.clientHeight : document.body.clientHeight),\r\n  /** 浏览器信息 */\r\n  userAgent: navigator.userAgent,\r\n  /** 浏览器语言 */\r\n  language: navigator.language\r\n}\r\n","\r\n/**\r\n * 是否为IE浏览器\r\n * @export\r\n * @returns {boolean} \r\n */\r\nexport function isIE(): boolean {\r\n  return navigator.appVersion.indexOf(\"MSIE\") !== -1;\r\n}\r\n\r\n/**\r\n * 生产唯一ID\r\n * @export\r\n * @returns {string} - 唯一guid\r\n */\r\nexport function guid(): string {\r\n  var crypto = window.crypto || window['msCrypto'];\r\n\r\n  if (crypto && crypto.getRandomValues) {\r\n    // Use window.crypto API if available\r\n    var arr = new Uint16Array(8);\r\n    crypto.getRandomValues(arr);\r\n\r\n    // set 4 in byte 7\r\n    arr[3] = arr[3] & 0xFFF | 0x4000;\r\n    // set 2 most significant bits of byte 9 to '10'\r\n    arr[4] = arr[4] & 0x3FFF | 0x8000;\r\n\r\n    var pad = function (num) {\r\n      var v = num.toString(16);\r\n      while (v.length < 4) {\r\n        v = '0' + v;\r\n      }\r\n      return v;\r\n    };\r\n\r\n    return pad(arr[0]) + pad(arr[1]) + pad(arr[2]) + pad(arr[3]) + pad(arr[4]) +\r\n      pad(arr[5]) + pad(arr[6]) + pad(arr[7]);\r\n  } else {\r\n    // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\r\n    return 'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n      var r = Math.random() * 16 | 0,\r\n        v = c === 'x' ? r : r & 0x3 | 0x8;\r\n      return v.toString(16);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * 文档绑定自定义事件\r\n * @export\r\n * @param {string} eventType \r\n * @param {Object} [options={}] \r\n * @returns {void} \r\n */\r\nexport function triggerEvent(eventType: string, options: Object = {}): void {\r\n  if (!document) return;\r\n\r\n  let _event: Event;\r\n  let key: string;\r\n\r\n  eventType = eventType.substr(0, 1).toUpperCase + eventType.substr(1);\r\n\r\n  if (document.createEvent) {\r\n    _event = document.createEvent('HTMLEvents');\r\n    _event.initEvent(eventType, true, true);\r\n  } else {\r\n    // IE8-9\r\n    _event = document['createEventObject']();\r\n    (_event as any).eventType = eventType;\r\n  }\r\n\r\n  for (key in options) {\r\n    if (options.hasOwnProperty(key)) {\r\n      _event[key] = options[key];\r\n    }\r\n  }\r\n\r\n  if (document.createEvent) {\r\n    document.dispatchEvent(_event);\r\n  } else {\r\n    document['fireEvent']('on' + (_event as any).eventType.toLowerCase(), _event);\r\n  }\r\n}\r\n\r\n/**\r\n * 原生方法垫片\r\n * @param {Object} obj - 内置对象，例：`window`, `document`\r\n * @param {string} name - 内置对象的函数名称，例：`addEventListener`\r\n * @param {Function} replacement - 替换后的函数\r\n * @param {*} [track] - record instrumentation to an array\r\n */\r\nexport function polyfill(obj: Object, name: string, replacement: Function, track?: any): void {\r\n  const origin = obj[name];\r\n  obj[name] = replacement(origin);\r\n  if (track) {\r\n    track.push([obj, name, origin]);\r\n  }\r\n}\r\n\r\nexport function wrap(options: any, func?: any, origin?: any) {\r\n  if (!func && typeof options !== 'function') return options;\r\n\r\n  if (typeof options === 'function') {\r\n    func = options;\r\n    options = undefined;\r\n  }\r\n\r\n  if (typeof func !== 'function') return func;\r\n\r\n  try {\r\n    if (func.trace) return func;\r\n    if (func.track_wrapper) return func.track_wrapper;\r\n  } catch (e) {\r\n    return func;\r\n  }\r\n\r\n  function wrapped() {\r\n    let trace, inner;\r\n    var args = [], i = arguments.length,\r\n      deep = !options || options && options.deep !== false;\r\n\r\n    if (origin && typeof origin === 'function') {\r\n      origin.apply(this, arguments);\r\n    }\r\n\r\n    while (i--) args[i] = deep ? wrap(options, arguments[i]) : arguments[i];\r\n\r\n    try {\r\n      return func.apply(this, args);\r\n    } catch (e) {\r\n      // self._ignoreNextOnError();\r\n      // self.captureException(e, options);\r\n      throw e;\r\n    }\r\n\r\n  }\r\n  // copy over properties of the old function\r\n  for (var property in func) {\r\n    if (func.hasOwnProperty(process)) {\r\n      wrapped[property] = func[property];\r\n    }\r\n  }\r\n  wrapped.prototype = func.prototype;\r\n\r\n  func.track_wrapper = wrapped;\r\n  // Signal that this function has been wrapped already\r\n  // for both debugging and to prevent it to being wrapped twice\r\n  // wrapped.trace = true;\r\n  // wrapped.inner = func;\r\n\r\n  return wrapped;\r\n}\r\n\r\n\r\n/**\r\n * \r\n * @param {Array<RegExp>} patterns \r\n * @returns {RegExp} \r\n */\r\nexport function joinRegExp(patterns: Array<RegExp>): RegExp {\r\n  let sources = [];\r\n  let pattern;\r\n  for (let i = 0; i < patterns.length; i++) {\r\n    pattern = patterns[i];\r\n    if (typeof pattern === 'string') {\r\n      sources.push(pattern.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, '\\\\$1'));\r\n    } else if (pattern && pattern.source) {\r\n      // If it's a regexp already, we want to extract the source\r\n      sources.push(pattern.source);\r\n    }\r\n  }\r\n  return new RegExp(sources.join('|'), 'i');\r\n}\r\n\r\n/**\r\n * Given a child DOM element, returns a query-selector statement describing that\r\n * and its ancestors\r\n * e.g. [HTMLElement] => body > div > input#foo.btn[name=baz]\r\n * @param elem\r\n * @returns {string}\r\n */\r\nexport function htmlTreeAsString(element: HTMLElement): string {\r\n  var MAX_TRAVERSE_HEIGHT = 5,\r\n    MAX_OUTPUT_LEN = 80,\r\n    out = [],\r\n    height = 0,\r\n    len = 0,\r\n    separator = ' > ',\r\n    sepLength = separator.length,\r\n    nextStr;\r\n\r\n  while (element && height++ < MAX_TRAVERSE_HEIGHT) {\r\n    nextStr = htmlElementAsString(element);\r\n    if (nextStr === 'html' || height > 1 && len + (out.length * sepLength) + nextStr.length >= MAX_OUTPUT_LEN) {\r\n      break;\r\n    }\r\n\r\n    out.push(nextStr);\r\n\r\n    len += nextStr.length;\r\n    element = element.parentElement;\r\n  }\r\n\r\n  return out.reverse().join(separator);\r\n}\r\n\r\n/**\r\n * Returns a simple, query-selector representation of a DOM element\r\n * e.g. [HTMLElement] => input#foo.btn[name=baz]\r\n * @param HTMLElement\r\n * @returns {string}\r\n */\r\nfunction htmlElementAsString(element: HTMLElement): string {\r\n  var out = [],\r\n    className,\r\n    classes,\r\n    key,\r\n    attr,\r\n    i;\r\n\r\n  if (!element || !element.tagName) {\r\n    return '';\r\n  }\r\n\r\n  out.push(element.tagName.toLowerCase());\r\n  if (element.id) {\r\n    out.push('#' + element.id);\r\n  }\r\n\r\n  className = element.className;\r\n  if (className && typeof className === 'string') {\r\n    classes = className.split(/\\s+/);\r\n    for (i = 0; i < classes.length; i++) {\r\n      out.push('.' + classes[i]);\r\n    }\r\n  }\r\n  var attrWhitelist = ['type', 'name', 'title', 'alt'];\r\n  for (i = 0; i < attrWhitelist.length; i++) {\r\n    key = attrWhitelist[i];\r\n    attr = element.getAttribute(key);\r\n    if (attr) {\r\n      out.push('[' + key + '=\"' + attr + '\"]');\r\n    }\r\n  }\r\n  return out.join('');\r\n}\r\n\r\n// borrowed from https://tools.ietf.org/html/rfc3986#appendix-B\r\n// intentionally using regex and not <a/> href parsing trick because React Native and other\r\n// environments where DOM might not be available\r\nexport function parseUrl(url: string) {\r\n  var match = url.match(/^(([^:\\/?#]+):)?(\\/\\/([^\\/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$/);\r\n  if (!match) return;\r\n\r\n  // coerce to undefined values to empty string so we don't get 'undefined'\r\n  var query = match[6] || '';\r\n  var fragment = match[8] || '';\r\n  return {\r\n    protocol: match[2],\r\n    host: match[4],\r\n    path: match[5],\r\n    relative: match[5] + query + fragment // everything minus origin\r\n  };\r\n}\r\n\r\n/**\r\n * 获取元素的属性值 \r\n * @param {HTMLElement} element  - 需要获取属性的元素\r\n * @returns {Object} - 属性键值对象\r\n */\r\nexport function getAttributes(element: HTMLElement): Object {\r\n  const result: Object = {};\r\n  const attributes: NamedNodeMap = element.attributes;\r\n\r\n  for (let i = 0; i < attributes.length; i++) {\r\n    const item = attributes[i];\r\n    result[item.name] = item.value;\r\n  }\r\n\r\n  return result;\r\n}","import { getAttributes, htmlTreeAsString, polyfill, wrap, parseUrl } from './util';\r\nimport { OnError } from './onError';\r\nconst objectAssign = Object.assign || require('object-assign');\r\n\r\nexport class BreadCrumbs {\r\n  public crumbsData: Array<Trace.BreadCrumb> = [];\r\n\r\n  private _config: Trace.Config;\r\n  private wrappedBuiltIns: Array<any> = [];\r\n\r\n  private clickEventSelectors: Array<string>;\r\n  private changeEventSelectors: Array<string>;\r\n\r\n  private lastEvent: Event = null;\r\n  private lastHref: string = '';\r\n\r\n  constructor(config: Trace.Config) {\r\n    this._config = config;\r\n    this.getDomBreadcrumbs();\r\n    this.getXhrBreadcrumbs();\r\n    this.getLocationBreadcurmbs();\r\n    this.getConsoleBreadcrumbs();\r\n  }\r\n\r\n  /**\r\n   * 获取事件操作并写入面包屑\r\n   * @private\r\n   */\r\n  private getDomBreadcrumbs(): void {\r\n    if (!this._config.autoBreadcrumbs.dom) return;\r\n\r\n    this.clickEventSelectors = ['a', 'button', 'input[button]', 'input[submit]', 'input[radio]', 'input[checkbox]'];\r\n    this.changeEventSelectors = ['input[text]', 'input[password]', 'textarea', 'select'];\r\n\r\n    if (document.addEventListener) {\r\n      document.addEventListener('click', (event: MouseEvent) => {\r\n        this.eventHandler('click', this.clickEventSelectors, event);\r\n      }, true);\r\n      document.addEventListener('blur', (event: MouseEvent) => {\r\n        this.eventHandler('input', this.changeEventSelectors, event)\r\n      }, true);\r\n    } else {\r\n      // IE8\r\n      document['attachEvent']('onclick', (event: MouseEvent) => {\r\n        this.eventHandler('click', this.clickEventSelectors, event);\r\n      });\r\n      document['attachEvent']('onblur', (event: MouseEvent) => {\r\n        this.eventHandler('click', this.clickEventSelectors, event);\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @private\r\n   * @param {string} eventName \r\n   * @param {Array<string>} selectorFilters \r\n   * @param {MouseEvent} event \r\n   */\r\n  private eventHandler(eventName: string, selectorFilters: Array<string>, event: MouseEvent): void {\r\n    const target = event.target || event.srcElement;\r\n    const tagName: string = (target as HTMLElement).tagName.toLowerCase();\r\n\r\n    if (this.acceptTag(target as HTMLElement, selectorFilters)) {\r\n      const attributes = getAttributes(target as HTMLElement);\r\n      let inputElement = target as HTMLInputElement;\r\n\r\n      const result: Trace.BreadCrumb = {\r\n        category: `ui.${eventName}`,\r\n        htmlTree: htmlTreeAsString(target as HTMLElement)\r\n      }\r\n\r\n      this.captureBreadcrumb(result);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查看某个元素是否在要监控的元素类型列表中\r\n   * @private\r\n   * @param {HTMLElement} element - 要检测的元素\r\n   * @param {Array<string>} selectors - 元素列表字符串\r\n   * @returns {boolean} - 检测结果\r\n   */\r\n  private acceptTag(element: HTMLElement, selectors: Array<string>): boolean {\r\n    let tag: string = element.tagName.toLowerCase();\r\n    if (tag === 'input' && element.getAttribute('type')) {\r\n      tag += `[${element.getAttribute('type')}]`\r\n    }\r\n    return selectors.indexOf(tag) > -1;\r\n  }\r\n\r\n\r\n  /**\r\n   * 获取事件操作并写入面包屑\r\n   */\r\n  private getXhrBreadcrumbs() {\r\n    if (!this._config.autoBreadcrumbs.xhr) return;\r\n\r\n    const self = this;\r\n    const autoBreadcrumbs = this._config.autoBreadcrumbs;\r\n    const wrappedBuiltIns = this.wrappedBuiltIns;\r\n    const xhrproto = XMLHttpRequest.prototype;\r\n\r\n    function wrapProp(prop, xhr) {\r\n      if (prop in xhr && typeof (xhr[prop]) === 'function') {\r\n        polyfill(xhr, prop, function (origin) {\r\n          return wrap(origin);\r\n        });\r\n      }\r\n    }\r\n\r\n    // 复制改下 xhr open 用于监听\r\n    polyfill(xhrproto, 'open', function (origOpen: any) {\r\n      return function (method: string, url: string) {\r\n\r\n        this._trace_xhr = {\r\n          method: method,\r\n          url: url,\r\n          statusCode: null\r\n        };\r\n        return origOpen.apply(this, arguments);\r\n      };\r\n    }, wrappedBuiltIns);\r\n\r\n    // 复制改下 xhr send 用于监听\r\n    polyfill(xhrproto, 'send', function (origSend) {\r\n      return function (data) {\r\n        var xhr = this;\r\n        function onreadystatechangeHandler() {\r\n          if (xhr._trace_xhr && (xhr.readyState === 1 || xhr.readyState === 4)) {\r\n            xhr._trace_xhr.statusCode = xhr.status;\r\n            self.captureBreadcrumb({\r\n              type: 'http',\r\n              category: 'xhr',\r\n              data: xhr._trace_xhr\r\n            });\r\n          }\r\n        }\r\n\r\n        const props = ['onload', 'onerror', 'onprogress'];\r\n        for (var j = 0; j < props.length; j++) {\r\n          wrapProp(props[j], xhr);\r\n        }\r\n\r\n        if ('onreadystatechange' in xhr && typeof xhr.onreadystatechange === 'function') {\r\n          polyfill(xhr, 'onreadystatechange', function (origin) {\r\n            return wrap(origin, undefined, onreadystatechangeHandler);\r\n          })\r\n        } else {\r\n          xhr.onreadystatechange = onreadystatechangeHandler;\r\n        }\r\n        return origSend.apply(this, arguments);\r\n      };\r\n    }, wrappedBuiltIns);\r\n  }\r\n\r\n  private getLocationBreadcurmbs() {\r\n    if (!this._config.autoBreadcrumbs.location) return;\r\n\r\n    const wrappedBuiltIns = this.wrappedBuiltIns;\r\n    const self = this;\r\n    const chrome = window['chrome'];\r\n    const isChromePackagedApp = chrome && chrome.app && chrome.app.runtime;\r\n    const hasPushState = !isChromePackagedApp && window.history && history.pushState;\r\n    if (hasPushState) {\r\n      var oldOnPopState = window.onpopstate;\r\n      window.onpopstate = function () {\r\n        var currentHref = location.href;\r\n        self.captureUrlChange(self.lastHref, currentHref);\r\n        if (oldOnPopState) {\r\n          return oldOnPopState.apply(this, arguments);\r\n        }\r\n      };\r\n\r\n      polyfill(history, 'pushState', function (origPushState) {\r\n        // note history.pushState.length is 0; intentionally not declaring\r\n        // params to preserve 0 arity\r\n        return function (/* state, title, url */) {\r\n          var url = arguments.length > 2 ? arguments[2] : undefined;\r\n\r\n          // url argument is optional\r\n          if (url) {\r\n            // coerce to string (this is what pushState does)\r\n            self.captureUrlChange(self.lastHref, url + '');\r\n          }\r\n\r\n          return origPushState.apply(this, arguments);\r\n        };\r\n      }, wrappedBuiltIns);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Captures a breadcrumb of type \"navigation\", normalizing input URLs\r\n   * @param to the originating URL\r\n   * @param from the target URL\r\n   * @private\r\n   */\r\n  private captureUrlChange(from, to) {\r\n    var parsedLoc = parseUrl(location.href);\r\n    var parsedTo = parseUrl(to);\r\n    var parsedFrom = parseUrl(from);\r\n\r\n    // because onpopstate only tells you the \"new\" (to) value of location.href, and\r\n    // not the previous (from) value, we need to track the value of the current URL\r\n    // state ourselves\r\n    this.lastHref = to;\r\n\r\n    // Use only the path component of the URL if the URL matches the current\r\n    // document (almost all the time when using pushState)\r\n    if (parsedLoc.protocol === parsedTo.protocol && parsedLoc.host === parsedTo.host)\r\n      to = parsedTo.relative;\r\n    if (parsedLoc.protocol === parsedFrom.protocol && parsedLoc.host === parsedFrom.host)\r\n      from = parsedFrom.relative;\r\n\r\n    this.captureBreadcrumb({\r\n      category: 'navigation',\r\n      data: {\r\n        to: to,\r\n        from: from\r\n      }\r\n    });\r\n  }\r\n\r\n  private getConsoleBreadcrumbs() {\r\n    if (!this._config.autoBreadcrumbs.console) return;\r\n    if ('console' in window && console.log) {\r\n      const consoleMethodCallback = (msg, data) => {\r\n        this.captureBreadcrumb({\r\n          message: msg,\r\n          level: data.level,\r\n          category: 'console'\r\n        });\r\n      };\r\n      ['debug', 'info', 'warn', 'error', 'log'].forEach((item) => {\r\n        this.wrapConsole(console, item, consoleMethodCallback);\r\n      })\r\n    }\r\n  }\r\n\r\n  private wrapConsole(console, level, callback) {\r\n    const originalConsoleLevel = console[level];\r\n    const originalConsole = console;\r\n\r\n    if (!(level in console)) {\r\n      return;\r\n    }\r\n\r\n    var sentryLevel = level === 'warn'\r\n      ? 'warning'\r\n      : level;\r\n\r\n    console[level] = function () {\r\n      var args = [].slice.call(arguments);\r\n\r\n      var msg = '' + args.join(' ');\r\n      var data = { level: sentryLevel, logger: 'console', extra: { 'arguments': args } };\r\n      callback && callback(msg, data);\r\n\r\n      // this fails for some browsers. :(\r\n      if (originalConsoleLevel) {\r\n        // IE9 doesn't allow calling apply on console functions directly\r\n        // See: https://stackoverflow.com/questions/5472938/does-ie9-support-console-log-and-is-it-a-real-function#answer-5473193\r\n        Function.prototype.apply.call(\r\n          originalConsoleLevel,\r\n          originalConsole,\r\n          args\r\n        );\r\n      }\r\n    };\r\n  };\r\n\r\n  /**\r\n   * 写入面包屑\r\n   * @private\r\n   * @param {Trace.BreadCrumb} crumb \r\n   */\r\n  private captureBreadcrumb(crumb: Trace.BreadCrumb): void {\r\n    let _crumb = objectAssign({}, crumb, { timestamp: new Date().getTime() });\r\n    this.crumbsData.push(_crumb);\r\n\r\n    // 超出后删除最先记录的一个\r\n    if (this.crumbsData.length > this._config.maxBreadcrumbs) {\r\n      this.crumbsData.shift()\r\n    }\r\n  }\r\n}","import TraceKit from './tracekit.js';\r\nimport { makeRequest } from './request';\r\nimport { environment } from './environment';\r\nimport { BreadCrumbs } from './breadcrumbs';\r\nimport { triggerEvent, guid } from './util';\r\nconst objectAssign = Object.assign || require('object-assign');\r\n\r\nexport class OnError {\r\n  private _config: Trace.Config;\r\n  private TraceKit = TraceKit;\r\n  private breadcrumbs: BreadCrumbs;\r\n\r\n  private lastGuid: string = null;\r\n  private lastReport: Trace.Report = null;\r\n\r\n  constructor(config: Trace.Config) {\r\n    this._config = config;\r\n    TraceKit.report.subscribe((errorReport: any) => {\r\n      this.handleStackInfo(errorReport)\r\n    })\r\n    this.breadcrumbs = new BreadCrumbs(config);\r\n  }\r\n\r\n  /**\r\n   * 处理栈信息\r\n   * @private\r\n   * @param {TraceKit.StackTrace} stackInfo TraceKit获取的栈信息\r\n   */\r\n  private handleStackInfo(stackInfo: TraceKit.StackTrace): void {\r\n    let frames: Array<Trace.StackFrame> = this.prepareFrames(stackInfo);\r\n\r\n    triggerEvent('handle', { stackInfo });\r\n\r\n    this.processException(stackInfo.name, stackInfo.message, stackInfo.url, frames)\r\n  }\r\n\r\n  /**\r\n   * 设置栈帧数据集\r\n   * @private\r\n   * @param {TraceKit.StackTrace} stackInfo TraceKit获取的栈信息\r\n   * @returns {Trace.StackFrame[]} \r\n   */\r\n  private prepareFrames(stackInfo: TraceKit.StackTrace): Trace.StackFrame[] {\r\n    let frames: Array<Trace.StackFrame> = [];\r\n    if (stackInfo.stack && stackInfo.stack.length) {\r\n      stackInfo.stack.forEach(item => {\r\n        let frame = this.normalizeFrame(item);\r\n        if (frame) frames.push(frame)\r\n      });\r\n    }\r\n    frames = frames.slice(0, this._config.maxStackDepth);\r\n    return frames;\r\n  }\r\n\r\n  /**\r\n   * 统一自定义栈帧结构\r\n   * @private\r\n   * @param {TraceKit.StackFrame} frame - TraceKit获取的栈帧\r\n   * @returns {Trace.StackFrame} - 统一后的栈帧对象\r\n   */\r\n  private normalizeFrame(frame: TraceKit.StackFrame): Trace.StackFrame {\r\n    if (!frame.url) return;\r\n    const normalized = {\r\n      fileName: frame.url,\r\n      lineNumber: frame.line,\r\n      columnNumber: frame.column,\r\n      function: frame.func || '?'\r\n    }\r\n    return normalized;\r\n  }\r\n\r\n  /**\r\n   * 处理异常\r\n   * @private\r\n   * @param {string} type - 异常类型\r\n   * @param {string} message - 异常信息\r\n   * @param {string} fileName - 异常路径\r\n   * @param {Array<Trace.StackFrame>} frames - 异常栈帧数据集\r\n   */\r\n  private processException(type: string, message: string, fileName: string, frames: Array<Trace.StackFrame>): void {\r\n    let config = this._config;\r\n    let stacktrace: Array<Trace.StackFrame> = [];\r\n    if (!!(config.ignoreErrors as RegExp).test && (config.ignoreErrors as RegExp).test(message)) return;\r\n\r\n    message += '';\r\n\r\n    if (frames && frames.length) {\r\n      fileName = frames[0].fileName || fileName;\r\n      frames.reverse(); // 倒序排列\r\n      stacktrace = frames;\r\n    } else if (fileName) {\r\n      stacktrace.push({\r\n        fileName\r\n      })\r\n    }\r\n\r\n    if (!!(config.ignoreUrls as RegExp).test && (config.ignoreUrls as RegExp).test(fileName)) return;\r\n\r\n    let exception: Array<Trace.CatchedException> = [{ type, message, stacktrace }];\r\n\r\n    // 处理报告数据\r\n    this.handlePayload(exception);\r\n  }\r\n\r\n  /**\r\n   * 处理报告数据\r\n   * @private\r\n   * @param {Array<Trace.CatchedException>} exception \r\n   */\r\n  private handlePayload(exception: Array<Trace.CatchedException>) {\r\n    // 合并报告\r\n    const reportData: Trace.Report = {\r\n      url: location.href,\r\n      title: document.title,\r\n      environment,\r\n      exception,\r\n      version: this._config.version,\r\n      apiKey: this._config.apiKey,\r\n      timestamp: new Date().getTime(),\r\n      guid: guid(),\r\n      breadcrumbs: this.breadcrumbs.crumbsData,\r\n    }\r\n    // 发送报告\r\n    this.sendPayload(reportData)\r\n  }\r\n\r\n  /**\r\n   * 发送报告\r\n   * @private\r\n   * @param {Trace.Report} payload\r\n   */\r\n  private sendPayload(payload: Trace.Report) {\r\n    if (!this._config.enabled) return;\r\n\r\n    this.lastGuid = payload.guid;\r\n    if (!this._config.repeatReport && this.isRepeatReport(payload)) return;\r\n\r\n    this.lastReport = payload;\r\n    const requestOptions = {\r\n      url: this._config.reportUrl,\r\n      data: payload,\r\n      onSuccess: () => {\r\n        triggerEvent('success', {\r\n          data: payload,\r\n          src: this._config.reportUrl\r\n        })\r\n        return new Promise(() => { });\r\n      },\r\n      OnError: (error) => {\r\n        triggerEvent('failure', {\r\n          data: payload,\r\n          src: this._config.reportUrl\r\n        })\r\n        error = error || new Error(`发送上报请求失败`);\r\n        return new Promise(resolve => resolve(error))\r\n      }\r\n    }\r\n    // 发送报告请求\r\n    makeRequest(requestOptions);\r\n  }\r\n\r\n  /**\r\n   * 判断两份报告是否重复\r\n   * @private\r\n   * @param {Trace.Report} current \r\n   * @returns {boolean} \r\n   */\r\n  private isRepeatReport(current: Trace.Report): boolean {\r\n    const last = this.lastReport;\r\n\r\n    // 如果最后一次报告没有或者两个 report 的 URL 都不相同直接返回 false\r\n    if (!last || current.url !== last.url) return false;\r\n\r\n    if (current.exception || last.exception) {\r\n      return this.isSameException(current.exception, last.exception);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * 判断两个异常数据集是否重复\r\n   * @private\r\n   * @param {Trace.CatchedException[]} arrayEx1 \r\n   * @param {Trace.CatchedException[]} arrayEx2 \r\n   * @returns {boolean} \r\n   */\r\n  private isSameException(arrayEx1: Trace.CatchedException[], arrayEx2: Trace.CatchedException[]): boolean {\r\n    if (!arrayEx1.length || !arrayEx2.length) return false;\r\n\r\n    const ex1: Trace.CatchedException = arrayEx1[0];\r\n    const ex2: Trace.CatchedException = arrayEx2[0];\r\n\r\n    if (ex1.type !== ex2.type || ex1.message !== ex2.message) return false;\r\n\r\n    return this.isSameStacktrace(ex1.stacktrace, ex2.stacktrace);\r\n  }\r\n\r\n  /**\r\n   * 判断两个栈帧数据集是否重复\r\n   * @private\r\n   * @param {Trace.StackFrame[]} stacktrace1 \r\n   * @param {Trace.StackFrame[]} stacktrace2 \r\n   * @returns {boolean} \r\n   */\r\n  private isSameStacktrace(stacktrace1: Trace.StackFrame[], stacktrace2: Trace.StackFrame[]): boolean {\r\n    if (!stacktrace1.length || !stacktrace2.length) return false;\r\n\r\n    stacktrace1.forEach((item, index) => {\r\n      if (item.fileName !== stacktrace2[index].fileName ||\r\n        item.columnNumber !== stacktrace2[index].columnNumber ||\r\n        item.lineNumber !== stacktrace2[index].lineNumber ||\r\n        item.function !== stacktrace2[index].function) return false;\r\n    })\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { defaultConfig } from './config';\r\nimport { OnError } from './onError';\r\nimport { joinRegExp } from './util';\r\nconst objectAssign = Object.assign || require('object-assign');\r\n\r\nclass Trace {\r\n  private globalConfig: Trace.Config = defaultConfig;\r\n\r\n  constructor(config?: Trace.Config) {\r\n    this.globalConfig = objectAssign({}, this.globalConfig, config);\r\n    this.handleConfig();\r\n    new OnError(this.globalConfig);\r\n  }\r\n\r\n  private handleConfig() {\r\n    // \"Script error.\" is hard coded into browsers for errors that it can't read.\r\n    // this is the result of a script being pulled in from an external domain and CORS.\r\n    const ignoreErrors = this.globalConfig.ignoreErrors as Array<RegExp>;\r\n    const ignoreUrls = this.globalConfig.ignoreErrors as Array<RegExp>;\r\n\r\n    ignoreErrors.push(/^Script error\\.?$/);\r\n    ignoreErrors.push(/^Javascript error: Script error\\.? on line 0$/);\r\n    this.globalConfig.ignoreErrors = joinRegExp(ignoreErrors);\r\n\r\n    this.globalConfig.ignoreUrls = ignoreUrls.length && joinRegExp(ignoreUrls);\r\n  }\r\n}\r\n\r\nexport default Trace;\r\n\r\nconst environment: any = window || this;\r\nenvironment.Trace = Trace;\r\n"],"names":["defaultConfig","TraceKit","_window","window","global","self","_slice","slice","UNKNOWN_FUNCTION","ERROR_TYPES_RE","getLocationHref","document","location","href","report","reportModuleWrapper","handlers","lastArgs","lastException","lastExceptionStack","subscribe","handler","push","unsubscribe","i","length","splice","unsubscribeAll","notifyHandlers","stack","isWindowError","exception","collectWindowErrors","hasOwnProperty","apply","concat","call","arguments","inner","_oldOnerrorHandler","_onErrorHandlerInstalled","traceKitWindowOnError","message","url","lineNo","colNo","ex","computeStackTrace","augmentStackTraceWithInitialElement","name","undefined","msg","groups","toString","match","func","installGlobalHandler","onerror","uninstallGlobalHandler","processLastException","_lastExceptionStack","_lastArgs","rethrow","args","incomplete","uninstall","computeStackTraceWrapper","computeStackTraceFromStackProp","chrome","gecko","winjs","chromeEval","lines","split","submatch","parts","element","reference","exec","j","isNative","indexOf","isEval","geckoEval","columnNumber","column","line","stackInfo","initial","unshift","partial","computeStackTraceByWalkingCallerChain","depth","functionName","funcs","recursion","item","source","curr","caller","input","substring","e","result","sourceURL","fileName","lineNumber","description","debug","options","request","XMLHttpRequest","hasCORS","XDomainRequest","onreadystatechange","readyState","status","onSuccess","onError","error","Error","replace","onload","open","send","JSON","stringify","data","environment","documentElement","clientWidth","body","clientHeight","navigator","userAgent","language","crypto","getRandomValues","arr","Uint16Array","pad","num","v","c","r","Math","random","eventType","_event","key","substr","toUpperCase","createEvent","initEvent","dispatchEvent","toLowerCase","obj","replacement","track","origin","trace","track_wrapper","deep","wrap","property","process","prototype","wrapped","patterns","sources","pattern","RegExp","join","MAX_TRAVERSE_HEIGHT","MAX_OUTPUT_LEN","out","height","len","separator","sepLength","nextStr","htmlElementAsString","parentElement","reverse","className","classes","attr","tagName","id","attrWhitelist","getAttribute","query","fragment","attributes","value","objectAssign","Object","assign","require","config","_config","getDomBreadcrumbs","getXhrBreadcrumbs","getLocationBreadcurmbs","getConsoleBreadcrumbs","autoBreadcrumbs","dom","clickEventSelectors","changeEventSelectors","addEventListener","event","eventHandler","eventName","selectorFilters","target","srcElement","acceptTag","getAttributes","inputElement","htmlTreeAsString","captureBreadcrumb","selectors","tag","xhr","wrappedBuiltIns","xhrproto","prop","origOpen","method","_trace_xhr","origSend","statusCode","props","onreadystatechangeHandler","isChromePackagedApp","app","runtime","hasPushState","history","pushState","oldOnPopState","onpopstate","currentHref","captureUrlChange","lastHref","origPushState","from","to","parsedLoc","parseUrl","parsedTo","parsedFrom","protocol","host","relative","console","log","consoleMethodCallback","level","forEach","wrapConsole","callback","originalConsoleLevel","originalConsole","sentryLevel","logger","extra","crumb","_crumb","timestamp","Date","getTime","crumbsData","maxBreadcrumbs","shift","errorReport","handleStackInfo","breadcrumbs","BreadCrumbs","frames","prepareFrames","processException","frame","normalizeFrame","maxStackDepth","normalized","type","stacktrace","ignoreErrors","test","ignoreUrls","handlePayload","reportData","title","version","apiKey","guid","sendPayload","payload","enabled","lastGuid","repeatReport","isRepeatReport","lastReport","requestOptions","reportUrl","Promise","resolve","current","last","isSameException","arrayEx1","arrayEx2","ex1","ex2","isSameStacktrace","stacktrace1","stacktrace2","index","function","globalConfig","handleConfig","OnError","joinRegExp","this","Trace"],"mappings":"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"}